"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1239],{1239:(O,v,c)=>{c.r(v),c.d(v,{LatencyTestPageModule:()=>z});var T=c(177),f=c(4341),r=c(7863),L=c(305),y=c(467),t=c(4438),F=c(9640),P=c(5092),m=c(4262),M=c(1626);let S=(()=>{var n;class g{constructor(e,o){this.firestore=e,this.http=o,this.ipApiURL="https://cors-ea3m.onrender.com/http://ip-api.com/json/"}getLocation(e){var o=this;return(0,y.A)(function*(){console.log(e);const s=yield o.http.get(o.ipApiURL+e[0].dst_addr).toPromise();for(let i=0;i<e.length;i++)e[i].toLatitude=s.lat,e[i].toLongitude=s.lon,e[i].cityTo=s.city,e[i].countryTo=s.country;const p=e.map(i=>o.http.get(o.ipApiURL+i.from).toPromise());return(yield Promise.all(p)).forEach((i,l)=>{e[l].fromLatitude=i.lat,e[l].fromLongitude=i.lon,e[l].cityFrom=i.city,e[l].countryFrom=i.country}),console.log(e),e})()}saveLocationResults(e,o,d,s){var p=this;return(0,y.A)(function*(){try{console.log(s,"ripeData");const h=(0,m.rJ)(p.firestore,"teams",e,"products",o,"ripe"),i=(0,m.H9)(h,d),l=s.map(a=>({from:a.from,dst_addr:a.dst_addr,latency:a.latency,cityFrom:a.cityFrom,countryFrom:a.countryFrom,cityTo:a.cityTo,countryTo:a.countryTo,fromLatitude:a.fromLatitude,fromLongitude:a.fromLongitude,toLatitude:a.toLatitude,toLongitude:a.toLongitude}));return yield(0,m.BN)(i,{data:l}),console.log("Data saved",{data:l}),!0}catch(h){return console.log(h),!1}})()}}return(n=g).\u0275fac=function(e){return new(e||n)(t.KVO(m._7),t.KVO(M.Qq))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),g})();var C=c(385),j=c(8453);function A(n,g){if(1&n&&(t.j41(0,"ion-item")(1,"ion-label"),t.EFF(2),t.k0s(),t.j41(3,"ion-label"),t.EFF(4),t.k0s(),t.j41(5,"ion-label"),t.EFF(6),t.k0s()()),2&n){const u=g.$implicit;t.R7$(2),t.Lme("FROM ",u.cityFrom,",",u.countryFrom,""),t.R7$(2),t.SpI("",u.latency," ms"),t.R7$(2),t.Lme(" TO ",u.cityTo,",",u.countryTo,"")}}const E=[{path:"",component:(()=>{var n;class g{constructor(e,o,d,s,p,h){this.ripeService=e,this.teamsService=o,this.loadingCtrl=d,this.locationService=s,this.route=p,this.alertCtrl=h,this.host="portfoliojuanfranciscocisneros.web.app",this.product="",this.description="NEW IONIC",this.type="ping",this.ripeResults=[]}ngOnInit(){}ionViewWillEnter(){this.route.params.subscribe(e=>{const o=new Date,d=o.getDate()+"/"+(o.getMonth()+1)+"/"+o.getFullYear()+"-"+o.getHours()+":"+o.getMinutes()+":"+o.getSeconds();this.description=e.productObjective+"-"+e.step+"-"+d})}sendRequest(){var e=this;return(0,y.A)(function*(){yield e.showLoading(),console.log(e.host,e.description,e.type);const o=yield e.ripeService.sendMeasurementRequest(e.host,e.description,e.type);!1!==o?(yield e.hideLoading(),yield e.showAlert("Test sent, please wait a few minutes to GET RESULTS for ID: "+o,"Success")):(yield e.hideLoading(),yield e.showAlert("Test not sent","Error"))})()}getResults(){var e=this;return(0,y.A)(function*(){yield e.showLoading(),e.ripeResults=[];const o=localStorage.getItem("user");if(!o)return;const s=JSON.parse(o).orgName;(yield e.ripeService.getMeasurementResults()).subscribe(function(){var p=(0,y.A)(function*(h){if(0===h.length)return yield e.hideLoading(),void(yield e.showAlert("No data found yet","Please wait a few minutes and try again"));for(let l=0;l<h.length;l++)e.ripeResults.push({latency:h[l].avg,dst_addr:h[l].dst_addr,from:h[l].from,toLatitude:0,toLongitude:0,fromLatitude:0,fromLongitude:0,cityTo:"",countryTo:"",cityFrom:"",countryFrom:""});let i=e.product;i=i.replace(/\s/g,""),console.log(i),yield e.ripeService.saveMeasurementResults(s,i,e.description,e.ripeResults).then((0,y.A)(function*(){yield e.locationService.getLocation(e.ripeResults).then(l=>{e.ripeResults=l,e.locationService.saveLocationResults(s,i,e.description,l).then(function(){var a=(0,y.A)(function*(R){R&&(console.log("Data saved"),console.log(e.ripeResults),yield e.hideLoading(),yield e.showAlert("Data saved and Showing Results","Success"))});return function(R){return a.apply(this,arguments)}}())})}))});return function(h){return p.apply(this,arguments)}}())})()}handleChange(e){this.type=e.detail.value}showLoading(){var e=this;return(0,y.A)(function*(){yield(yield e.loadingCtrl.create({})).present()})()}hideLoading(){var e=this;return(0,y.A)(function*(){yield e.loadingCtrl.dismiss()})()}showAlert(e,o){var d=this;return(0,y.A)(function*(){yield(yield d.alertCtrl.create({header:o,message:e,buttons:["OK"]})).present()})()}}return(n=g).\u0275fac=function(e){return new(e||n)(t.rXU(F.Q),t.rXU(P.O),t.rXU(r.Xi),t.rXU(S),t.rXU(L.nX),t.rXU(r.hG))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-latency-test"]],inputs:{host:"host",description:"description"},decls:28,vars:7,consts:[[3,"title"],[3,"fullscreen"],[1,"lg:m-10","md:m-10"],["size","12","size-md","4","size-lg","4",1,""],["label","Host Name","placeholder","Enter a host name","type","text","labelPlacement","stacked",1,"",3,"ngModelChange","ngModel"],["size","12","size-md","4","size-lg","4"],["readonly","true","label","Description","placeholder","Enter a description","type","text","labelPlacement","stacked",1,"",3,"ngModelChange","ngModel"],[3,"ionChange"],["value","ping"],["value","traceroute"],["size","12","size-md","12","size-lg","12",1,"flex","flex-row","justify-end"],["color","primary",1,"",3,"click"],["size","12","size-md","12","size-lg","12"],[4,"ngFor","ngForOf"]],template:function(e,o){1&e&&(t.nrm(0,"app-header",0),t.j41(1,"ion-content",1)(2,"ion-grid"),t.nrm(3,"app-title",0),t.j41(4,"ion-row",2)(5,"ion-col",3)(6,"ion-input",4),t.mxI("ngModelChange",function(s){return t.DH7(o.host,s)||(o.host=s),s}),t.k0s()(),t.j41(7,"ion-col",5)(8,"ion-input",6),t.mxI("ngModelChange",function(s){return t.DH7(o.description,s)||(o.description=s),s}),t.k0s()(),t.j41(9,"ion-col",5)(10,"ion-list")(11,"ion-item")(12,"ion-select",7),t.bIt("ionChange",function(s){return o.handleChange(s)}),t.j41(13,"ion-select-option",8),t.EFF(14,"Ping"),t.k0s(),t.j41(15,"ion-select-option",9),t.EFF(16,"Traceroute"),t.k0s()()()()()(),t.j41(17,"ion-row",2)(18,"ion-col",10)(19,"ion-button",11),t.bIt("click",function(){return o.sendRequest()}),t.EFF(20,"Add Test"),t.k0s(),t.j41(21,"ion-button",11),t.bIt("click",function(){return o.getResults()}),t.EFF(22,"Get Results"),t.k0s()()(),t.nrm(23,"app-title",0),t.j41(24,"ion-row",2)(25,"ion-col",12)(26,"ion-list"),t.DNE(27,A,7,5,"ion-item",13),t.k0s()()()()()),2&e&&(t.Y8G("title","Latency Test"),t.R7$(),t.Y8G("fullscreen",!0),t.R7$(2),t.Y8G("title","New Latency Test"),t.R7$(3),t.R50("ngModel",o.host),t.R7$(2),t.R50("ngModel",o.description),t.R7$(15),t.Y8G("title","Test Results History"),t.R7$(4),t.Y8G("ngForOf",o.ripeResults))},dependencies:[T.Sq,f.BC,f.vS,r.Jm,r.hU,r.W9,r.lO,r.$w,r.uz,r.he,r.nf,r.ln,r.Nm,r.Ip,r.Je,r.Gw,C.l,j.W]}),g})()}];let w=(()=>{var n;class g{}return(n=g).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[L.iI.forChild(E),L.iI]}),g})();var I=c(5553);let z=(()=>{var n;class g{}return(n=g).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[T.MD,f.YN,r.bv,w,I.h]}),g})()}}]);