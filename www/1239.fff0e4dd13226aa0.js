"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1239],{1239:(b,v,d)=>{d.r(v),d.d(v,{LatencyTestPageModule:()=>O});var R=d(177),f=d(4341),c=d(7863),L=d(305),g=d(467),t=d(4438),T=d(9640),m=d(4262),F=d(1626);let P=(()=>{var i;class u{constructor(e,o){this.firestore=e,this.http=o,this.ipApiURL="https://cors-ea3m.onrender.com/http://ip-api.com/json/"}getLocation(e){var o=this;return(0,g.A)(function*(){console.log(e);const n=yield o.http.get(o.ipApiURL+e[0].dst_addr).toPromise();for(let l=0;l<e.length;l++)e[l].toLatitude=n.lat,e[l].toLongitude=n.lon,e[l].cityTo=n.city,e[l].countryTo=n.country;const r=e.map(l=>o.http.get(o.ipApiURL+l.from).toPromise());return(yield Promise.all(r)).forEach((l,h)=>{e[h].fromLatitude=l.lat,e[h].fromLongitude=l.lon,e[h].cityFrom=l.city,e[h].countryFrom=l.country}),console.log(e),e})()}saveLocationResults(e,o,s,n){var r=this;return(0,g.A)(function*(){try{console.log(n,"ripeData");const y=(0,m.rJ)(r.firestore,"teams",e,"products",o,"ripe"),l=(0,m.H9)(y,s),h=n.map(p=>({from:p.from,dst_addr:p.dst_addr,latency:p.latency,cityFrom:p.cityFrom,countryFrom:p.countryFrom,cityTo:p.cityTo,countryTo:p.countryTo,fromLatitude:p.fromLatitude,fromLongitude:p.fromLongitude,toLatitude:p.toLatitude,toLongitude:p.toLongitude}));return yield(0,m.BN)(l,{data:h}),console.log("Data saved",{data:h}),!0}catch(y){return console.log(y),!1}})()}}return(i=u).\u0275fac=function(e){return new(e||i)(t.KVO(m._7),t.KVO(F.Qq))},i.\u0275prov=t.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),u})();var j=d(385),S=d(8453);function M(i,u){if(1&i&&(t.j41(0,"ion-item")(1,"ion-label"),t.EFF(2),t.k0s(),t.j41(3,"ion-label"),t.EFF(4),t.k0s(),t.j41(5,"ion-label"),t.EFF(6),t.k0s()()),2&i){const a=u.$implicit;t.R7$(2),t.Lme("FROM ",a.cityFrom,",",a.countryFrom,""),t.R7$(2),t.SpI("",a.latency," ms"),t.R7$(2),t.Lme(" TO ",a.cityTo,",",a.countryTo,"")}}function A(i,u){if(1&i&&(t.j41(0,"ion-item")(1,"ion-label"),t.EFF(2),t.k0s(),t.nrm(3,"ion-icon",14),t.k0s()),2&i){const a=u.$implicit;t.R7$(2),t.JRh(a)}}const C=[{path:"",component:(()=>{var i;class u{constructor(e,o,s,n,r){this.ripeService=e,this.loadingCtrl=o,this.locationService=s,this.route=n,this.alertCtrl=r,this.user={},this.orgName="",this.productObjective="",this.productStep="",this.host="portfoliojuanfranciscocisneros.web.app",this.description="NEW IONIC",this.type="ping",this.ripeResults=[],this.ripeHistoryResultsID=[]}ngOnInit(){}ionViewWillEnter(){var e=this;return(0,g.A)(function*(){yield e.showLoading(),e.route.params.subscribe(s=>{e.productObjective=s.productObjective,e.productStep=s.step;const n=new Date,r=n.getDate()+"-"+(n.getMonth()+1)+"-"+n.getFullYear()+"-"+n.getHours()+":"+n.getMinutes()+":"+n.getSeconds();e.description=s.productObjective+"-"+s.step+"-"+r});const o=localStorage.getItem("user");o&&(e.user=JSON.parse(o),e.orgName=e.user.orgName,yield e.getHistoryResults(e.orgName,e.productObjective),yield e.hideLoading())})()}sendRequest(){var e=this;return(0,g.A)(function*(){yield e.showLoading();const o=yield e.ripeService.sendMeasurementRequest(e.host,e.description,e.type);!1!==o?(yield e.hideLoading(),yield e.showAlert("Test sent, please wait a few minutes to GET RESULTS for ID: "+o,"Success")):(yield e.hideLoading(),yield e.showAlert("Test not sent","Error"))})()}getResults(){var e=this;return(0,g.A)(function*(){yield e.showLoading(),e.ripeResults=[];try{let o=yield e.ripeService.getMeasurementResults();if(!o)return yield e.hideLoading(),void(yield e.showAlert("Please send a test first","Error"));o.subscribe(function(){var s=(0,g.A)(function*(n){if(0===n.length)return yield e.hideLoading(),void(yield e.showAlert("No data found yet","Please wait a few minutes and try again"));for(let r=0;r<n.length;r++)e.ripeResults.push({latency:n[r].avg,dst_addr:n[r].dst_addr,from:n[r].from,toLatitude:0,toLongitude:0,fromLatitude:0,fromLongitude:0,cityTo:"",countryTo:"",cityFrom:"",countryFrom:""});yield e.ripeService.saveMeasurementResults(e.orgName,e.productObjective,e.description,e.ripeResults).then((0,g.A)(function*(){yield e.locationService.getLocation(e.ripeResults).then(r=>{e.ripeResults=r,e.locationService.saveLocationResults(e.orgName,e.productObjective,e.description,r).then(function(){var y=(0,g.A)(function*(l){l&&(yield e.getHistoryResults(e.orgName,e.productObjective),yield e.hideLoading(),yield e.showAlert("Data saved and Showing Results","Success"))});return function(l){return y.apply(this,arguments)}}())})}))});return function(n){return s.apply(this,arguments)}}())}catch{yield e.hideLoading(),yield e.showAlert("Error getting results","Error")}})()}handleChange(e){this.type=e.detail.value}getHistoryResults(e,o){var s=this;return(0,g.A)(function*(){s.ripeHistoryResultsID=[],yield s.ripeService.getHistoryResults(e,o).then(function(){var n=(0,g.A)(function*(r){for(let y=0;y<r.length;y++)r[y].id.split("-")[1]===s.productStep&&s.ripeHistoryResultsID.push(r[y].id)});return function(r){return n.apply(this,arguments)}}())})()}showLoading(){var e=this;return(0,g.A)(function*(){yield(yield e.loadingCtrl.create({})).present()})()}hideLoading(){var e=this;return(0,g.A)(function*(){yield e.loadingCtrl.dismiss()})()}showAlert(e,o){var s=this;return(0,g.A)(function*(){yield(yield s.alertCtrl.create({header:o,message:e,buttons:["OK"]})).present()})()}}return(i=u).\u0275fac=function(e){return new(e||i)(t.rXU(T.Q),t.rXU(c.Xi),t.rXU(P),t.rXU(L.nX),t.rXU(c.hG))},i.\u0275cmp=t.VBU({type:i,selectors:[["app-latency-test"]],inputs:{host:"host",description:"description"},decls:33,vars:9,consts:[[3,"title"],[3,"fullscreen"],[1,"lg:m-10","md:m-10"],["size","12","size-md","4","size-lg","4",1,""],["label","Host Name","placeholder","Enter a host name","type","text","labelPlacement","stacked",1,"",3,"ngModelChange","ngModel"],["size","12","size-md","4","size-lg","4"],["readonly","true","label","Description","placeholder","Enter a description","type","text","labelPlacement","stacked",1,"",3,"ngModelChange","ngModel"],[3,"ionChange"],["value","ping"],["value","traceroute"],["size","12","size-md","12","size-lg","12",1,"flex","flex-row","justify-end"],["color","primary",1,"",3,"click"],["size","12","size-md","12","size-lg","12"],[4,"ngFor","ngForOf"],["name","arrow-forward","color","primary"]],template:function(e,o){1&e&&(t.nrm(0,"app-header",0),t.j41(1,"ion-content",1)(2,"ion-grid"),t.nrm(3,"app-title",0),t.j41(4,"ion-row",2)(5,"ion-col",3)(6,"ion-input",4),t.mxI("ngModelChange",function(n){return t.DH7(o.host,n)||(o.host=n),n}),t.k0s()(),t.j41(7,"ion-col",5)(8,"ion-input",6),t.mxI("ngModelChange",function(n){return t.DH7(o.description,n)||(o.description=n),n}),t.k0s()(),t.j41(9,"ion-col",5)(10,"ion-list")(11,"ion-item")(12,"ion-select",7),t.bIt("ionChange",function(n){return o.handleChange(n)}),t.j41(13,"ion-select-option",8),t.EFF(14,"Ping"),t.k0s(),t.j41(15,"ion-select-option",9),t.EFF(16,"Traceroute"),t.k0s()()()()()(),t.j41(17,"ion-row",2)(18,"ion-col",10)(19,"ion-button",11),t.bIt("click",function(){return o.sendRequest()}),t.EFF(20,"Add Test"),t.k0s(),t.j41(21,"ion-button",11),t.bIt("click",function(){return o.getResults()}),t.EFF(22,"Get Results"),t.k0s()()(),t.nrm(23,"app-title",0),t.j41(24,"ion-row",2)(25,"ion-col",12)(26,"ion-list"),t.DNE(27,M,7,5,"ion-item",13),t.k0s()()(),t.nrm(28,"app-title",0),t.j41(29,"ion-row",2)(30,"ion-col",12)(31,"ion-list"),t.DNE(32,A,4,1,"ion-item",13),t.k0s()()()()()),2&e&&(t.Y8G("title","Latency Test"),t.R7$(),t.Y8G("fullscreen",!0),t.R7$(2),t.Y8G("title","New Latency Test"),t.R7$(3),t.R50("ngModel",o.host),t.R7$(2),t.R50("ngModel",o.description),t.R7$(15),t.Y8G("title","Test Results"),t.R7$(4),t.Y8G("ngForOf",o.ripeResults),t.R7$(),t.Y8G("title","Test Results History"),t.R7$(4),t.Y8G("ngForOf",o.ripeHistoryResultsID))},dependencies:[R.Sq,f.BC,f.vS,c.Jm,c.hU,c.W9,c.lO,c.iq,c.$w,c.uz,c.he,c.nf,c.ln,c.Nm,c.Ip,c.Je,c.Gw,j.l,S.W]}),u})()}];let w=(()=>{var i;class u{}return(i=u).\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.$C({type:i}),i.\u0275inj=t.G2t({imports:[L.iI.forChild(C),L.iI]}),u})();var E=d(5553);let O=(()=>{var i;class u{}return(i=u).\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.$C({type:i}),i.\u0275inj=t.G2t({imports:[R.MD,f.YN,c.bv,w,E.h]}),u})()}}]);