"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7907],{5553:(F,j,r)=>{r.d(j,{h:()=>f});var a=r(177),m=r(7863),c=r(4438);let f=(()=>{var u;class e{}return(u=e).\u0275fac=function(y){return new(y||u)},u.\u0275mod=c.$C({type:u}),u.\u0275inj=c.G2t({imports:[a.MD,m.bv]}),e})()},3241:(F,j,r)=>{r.d(j,{p:()=>f});var a=r(4438),m=r(177),c=r(7863);let f=(()=>{var u;class e{constructor(y){this.location=y,this.title="Header Title"}ngOnInit(){}goBack(){this.location.back()}}return(u=e).\u0275fac=function(y){return new(y||u)(a.rXU(m.aZ))},u.\u0275cmp=a.VBU({type:u,selectors:[["app-header-return"]],inputs:{title:"title"},decls:6,vars:2,consts:[[3,"translucent"],["slot","start","menu","menu-id"],["name","arrow-back","slot","start",1,"p-4","bigger-icon",3,"click"]],template:function(y,s){1&y&&(a.j41(0,"ion-header",0)(1,"ion-toolbar"),a.nrm(2,"ion-menu-button",1),a.j41(3,"ion-icon",2),a.bIt("click",function(){return s.goBack()}),a.k0s(),a.j41(4,"ion-title"),a.EFF(5),a.k0s()()()),2&y&&(a.Y8G("translucent",!0),a.R7$(5),a.JRh(s.title))},dependencies:[c.eU,c.iq,c.MC,c.BC,c.ai],styles:[".bigger-icon[_ngcontent-%COMP%]{font-size:1.5em}"]}),e})()},8453:(F,j,r)=>{r.d(j,{W:()=>c});var a=r(4438),m=r(7863);let c=(()=>{var f;class u{constructor(){this.title="Title"}ngOnInit(){}}return(f=u).\u0275fac=function(g){return new(g||f)},f.\u0275cmp=a.VBU({type:f,selectors:[["app-title"]],inputs:{title:"title"},decls:4,vars:1,consts:[[1,"lg:m-10"],["size","12","size-md","6","size-lg","6"],[1,"text-4xl","lg:text-6xl","font-bold"]],template:function(g,y){1&g&&(a.j41(0,"ion-row",0)(1,"ion-col",1)(2,"h1",2),a.EFF(3),a.k0s()()()),2&g&&(a.R7$(3),a.JRh(y.title))},dependencies:[m.hU,m.ln]}),u})()},7907:(F,j,r)=>{r.r(j),r.d(j,{IncidentDetailsPageModule:()=>V});var a=r(177),m=r(4341),c=r(7863),f=r(7650),u=r(467),e=r(4438),g=r(2107),y=r(4624),s=r(7473),d=r(8453),l=r(3241);function _(n,p){if(1&n&&(e.j41(0,"ion-card-content")(1,"ion-label",26),e.EFF(2),e.k0s()()),2&n){const o=e.XpG();e.R7$(2),e.JRh(o.incident.state.toUpperCase())}}function v(n,p){if(1&n&&(e.j41(0,"ion-card-content")(1,"ion-label",27),e.EFF(2),e.k0s()()),2&n){const o=e.XpG();e.R7$(2),e.JRh(o.incident.state.toLocaleUpperCase())}}function I(n,p){if(1&n&&(e.j41(0,"ion-card-content")(1,"ion-label",27),e.EFF(2),e.k0s()()),2&n){const o=e.XpG();e.R7$(2),e.JRh(o.incident.urgency.toUpperCase())}}function C(n,p){if(1&n&&(e.j41(0,"ion-card-content")(1,"ion-label",28),e.EFF(2),e.k0s()()),2&n){const o=e.XpG();e.R7$(2),e.JRh(o.incident.urgency.toUpperCase())}}function R(n,p){if(1&n&&(e.j41(0,"ion-card-content")(1,"ion-label",29),e.EFF(2),e.k0s()()),2&n){const o=e.XpG();e.R7$(2),e.JRh(o.incident.urgency.toUpperCase())}}function b(n,p){if(1&n&&(e.j41(0,"ion-card-content")(1,"ion-label",26),e.EFF(2),e.k0s()()),2&n){const o=e.XpG();e.R7$(2),e.JRh(o.incident.urgency.toUpperCase())}}function D(n,p){if(1&n&&(e.j41(0,"ion-card-content")(1,"ion-label",27),e.EFF(2),e.k0s()()),2&n){const o=e.XpG();e.R7$(2),e.JRh(o.incident.org_impact.toUpperCase())}}function M(n,p){if(1&n&&(e.j41(0,"ion-card-content")(1,"ion-label",28),e.EFF(2),e.k0s()()),2&n){const o=e.XpG();e.R7$(2),e.JRh(o.incident.org_impact.toUpperCase())}}function T(n,p){if(1&n&&(e.j41(0,"ion-card-content")(1,"ion-label",29),e.EFF(2),e.k0s()()),2&n){const o=e.XpG();e.R7$(2),e.JRh(o.incident.org_impact.toUpperCase())}}function O(n,p){if(1&n&&(e.j41(0,"ion-card-content")(1,"ion-label",26),e.EFF(2),e.k0s()()),2&n){const o=e.XpG();e.R7$(2),e.JRh(o.incident.org_impact.toUpperCase())}}function k(n,p){if(1&n&&(e.j41(0,"div",12),e.nrm(1,"ion-icon",13),e.j41(2,"ion-label",8),e.EFF(3),e.k0s()()),2&n){const o=p.$implicit;e.R7$(3),e.JRh(o)}}function $(n,p){if(1&n&&(e.j41(0,"div",31)(1,"a",34),e.nrm(2,"img",35),e.k0s()()),2&n){const o=e.XpG().$implicit;e.R7$(),e.FS9("href",o.comment,e.B4B),e.R7$(),e.FS9("src",o.comment,e.B4B)}}function N(n,p){if(1&n&&(e.j41(0,"a",36)(1,"ion-chip"),e.nrm(2,"ion-icon",37),e.j41(3,"ion-label"),e.EFF(4),e.k0s()()()),2&n){const o=e.XpG().$implicit,t=e.XpG();e.FS9("href",o.comment,e.B4B),e.R7$(4),e.JRh(t.fileName(o.comment))}}function B(n,p){if(1&n&&(e.j41(0,"a",36)(1,"ion-chip",38),e.nrm(2,"ion-icon",37),e.j41(3,"ion-label"),e.EFF(4),e.k0s()()(),e.j41(5,"p"),e.EFF(6," This is an unknown file type. "),e.k0s()),2&n){const o=e.XpG().$implicit,t=e.XpG();e.FS9("href",o.comment,e.B4B),e.R7$(4),e.JRh(t.fileName(o.comment))}}function L(n,p){if(1&n&&e.nrm(0,"p",39),2&n){const o=e.XpG().$implicit;e.Y8G("innerHTML",o.comment,e.npT)}}function S(n,p){if(1&n&&(e.qex(0),e.j41(1,"ion-card",30)(2,"ion-card-content"),e.DNE(3,$,3,2,"div",31)(4,N,5,2)(5,B,7,2)(6,L,1,1),e.k0s(),e.j41(7,"ion-card-content",32)(8,"div",33),e.nrm(9,"ion-icon",13),e.j41(10,"ion-label",8),e.EFF(11),e.k0s()()()(),e.bVm()),2&n){const o=p.$implicit,t=e.XpG();e.R7$(),e.AVh("self-end",o.from===t.currentUser)("bg-gray-600",o.from===t.currentUser)("self-start",o.from!==t.currentUser)("bg-gray-800",o.from!==t.currentUser),e.R7$(2),e.vxM(3,t.isImage(o.comment)?3:t.isFile(o.comment)?4:"https:"===o.comment.split("/")[0]||"http:"===o.comment.split("/")[0]?5:6),e.R7$(8),e.JRh(o.from)}}function w(n,p){if(1&n){const o=e.RV6();e.j41(0,"ion-icon",40),e.bIt("click",function(){e.eBV(o);const i=e.XpG(),h=e.sdS(83);return e.Njj(i.uploadFile(h))}),e.k0s()}}function A(n,p){if(1&n){const o=e.RV6();e.j41(0,"ion-icon",41),e.bIt("click",function(){e.eBV(o);const i=e.XpG(),h=e.sdS(83);return e.Njj(i.deleteUploadfile(h))}),e.k0s()}}function G(n,p){if(1&n){const o=e.RV6();e.j41(0,"ion-button",42),e.bIt("click",function(){e.eBV(o);const i=e.XpG();return e.Njj(i.closeIncident())}),e.EFF(1,"Close Incident"),e.k0s()}}function X(n,p){if(1&n){const o=e.RV6();e.j41(0,"ion-button",43),e.bIt("click",function(){e.eBV(o);const i=e.XpG();return e.Njj(i.closeIncident())}),e.EFF(1,"Close Incident"),e.k0s()}2&n&&e.Y8G("disabled",!0)}function z(n,p){if(1&n){const o=e.RV6();e.j41(0,"ion-col",5)(1,"ion-card",6)(2,"ion-card-title",7),e.EFF(3,"Go to Incident Postmortem"),e.k0s(),e.j41(4,"ion-card-content")(5,"p"),e.EFF(6,"Postmortem Culture: Learning from Failure. The postmortem is a retrospective of the incident, focusing on what went wrong, what can be learned, and how to prevent similar incidents in the future."),e.k0s()(),e.j41(7,"ion-card-content",16)(8,"ion-button",44),e.bIt("click",function(){e.eBV(o);const i=e.XpG();return e.Njj(i.postmortemIncident())}),e.EFF(9,"Incident Postmortem"),e.k0s()()()()}}const K=[{path:"",component:(()=>{var n;class p{constructor(t,i,h,E,P){this.router=t,this.activatedRoute=i,this.loadingCtrl=h,this.incidentService=E,this.notificationService=P,this.productStep="",this.productObjective="",this.orgName="",this.currentUser="",this.incident={},this.newComment="",this.storage=(0,e.WQX)(g.wc),this.isImageLoaded=!1,this.decodeURIComponent=decodeURIComponent}ngOnInit(){}ionViewWillEnter(){var t=this;return(0,u.A)(function*(){t.getParams(),yield t.getIncident()})()}getParams(){this.activatedRoute.params.subscribe(i=>{this.productObjective=i.productObjective,this.productStep=i.step,this.incident.title=i.incidentTitle});const t=JSON.parse(localStorage.getItem("user"));this.orgName=t.orgName,this.currentUser=t.name,console.log(this.orgName),console.log(this.productObjective),console.log(this.productStep),console.log(this.incident.title)}getIncident(){var t=this;return(0,u.A)(function*(){yield t.showLoading(),t.incident=yield t.incidentService.getIncident(t.orgName,t.productObjective,t.productStep,t.incident.title),yield t.hideLoading()})()}addComment(){var t=this;return(0,u.A)(function*(){if(yield t.showLoading(),console.log("add comment"),console.log(t.currentUser),console.log(t.newComment),""===t.newComment)return void(yield t.hideLoading());t.incident.report?t.incident.report.push({comment:t.newComment.replace(/\n/g,"<br>"),from:t.currentUser}):t.incident.report=[{comment:t.newComment.replace(/\n/g,"<br>"),from:t.currentUser}],yield t.incidentService.updateIncident(t.orgName,t.productObjective,t.productStep,t.incident);let i=[];i.push({role:"Incident Commander",member:t.incident.incidentCommander}),i.push({role:"Communications Lead",member:t.incident.communications_lead}),i.push({role:"Operations Lead",member:t.incident.operations_lead});for(let E=0;E<t.incident.operation_team.length;E++)i.push({role:"Operations Team Member",member:t.incident.operation_team[E]});console.log(i);const h=window.location.href;yield t.notificationService.notifyIncidentUpdateToTeam(i,t.orgName,h),t.newComment="",t.hideLoading()})()}onImageLoad(){this.isImageLoaded=!0}uploadFile(t){var i=this;return(0,u.A)(function*(){if(yield i.showLoading(),!t.files)return;const h=t.files;for(let E=0;E<h.length;E++){const P=h.item(E);if(P){const Y=(0,g.KR)(i.storage,`incident/${i.orgName}/${i.productObjective}/${i.productStep}/\xb0/${P.name}`);yield(0,g.bp)(Y,P).then(U=>{console.log("Uploaded a blob or file!",U.ref.fullPath),i.downloadFile(U.ref.fullPath).then(function(){var Z=(0,u.A)(function*(x){i.newComment=x,yield i.hideLoading(),yield i.addComment(),i.isImageLoaded=!1});return function(x){return Z.apply(this,arguments)}}())})}}})()}downloadFile(t){var i=this;return(0,u.A)(function*(){let h="";return yield(0,g.qk)((0,g.KR)(i.storage,t)).then(E=>{console.log("File available at",E),h=E}),h})()}isImage(t){return/(\.jpg|\.jpeg|\.png|\.gif|\.bmp|\.webp)(\?|$)/i.test(t)}isFile(t){return/(\.csv|\.pdf|\.doc|\.docx|\.ppt|\.pptx|\.xls|\.xlsx|\.txt|\.mp3|\.wav|\.ogg|\.mp4|\.avi|\.mkv|\.mov|\.zip|\.rar|\.7z|\.tar|\.gz)(\?|$)/i.test(t)}fileName(t){var i;return null===(i=decodeURIComponent(t.split("/").pop().split("?")[0]).split("\xb0").pop())||void 0===i?void 0:i.substring(1)}closeIncident(){var t=this;this.incidentService.closeIncident(this.orgName,this.productObjective,this.productStep,this.incident).then(function(){var i=(0,u.A)(function*(h){h&&(yield t.router.navigate(["/incident-manager",{productObjective:t.productObjective,step:t.productStep}]))});return function(h){return i.apply(this,arguments)}}())}postmortemIncident(){var t=this;return(0,u.A)(function*(){yield t.router.navigate(["/incident-postmortem",{orgName:t.orgName,productObjective:t.productObjective,step:t.productStep,currentUser:t.currentUser,incidentTitle:t.incident.title}])})()}showLoading(){var t=this;return(0,u.A)(function*(){yield(yield t.loadingCtrl.create({})).present()})()}hideLoading(){var t=this;return(0,u.A)(function*(){yield t.loadingCtrl.dismiss()})()}deleteUploadfile(t){t.value="",this.isImageLoaded=!1}}return(n=p).\u0275fac=function(t){return new(t||n)(e.rXU(f.Ix),e.rXU(f.nX),e.rXU(c.Xi),e.rXU(y.I),e.rXU(s.J))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-incident-details"]],decls:100,vars:30,consts:[["upload",""],["title","Incident Details"],[3,"fullscreen"],[3,"title"],[1,"lg:m-10","md:m-10"],["size","12","size-md","12","size-lg","12",1,""],[1,"p-5","flex","flex-col","justify-center","items-center"],[1,"text-2xl"],[1,""],["size","6","size-md","4","size-lg","4",1,""],["size","12","size-md","4","size-lg","4",1,""],["size","6","size-md","6","size-lg","6",1,""],[1,"flex","flex-row","justify-center","items-center"],["name","person-circle",1,"text-2xl"],[1,"p-5","flex","flex-col","justify-center","items-start"],[4,"ngFor","ngForOf"],[1,"flex","flex-row","justify-center","items-center","w-full"],["placeholder","Add a comment","type","text",1,"w-2/3",3,"ngModelChange","hidden","autoGrow","ngModel"],[1,"pl-1","pr-1"],["size","large","name","cloud-upload",3,"click","hidden"],["type","file",2,"display","none",3,"change"],["size","large","class","ion-margin","expand","block","name","save",3,"click",4,"ngIf"],["size","large","class","ion-margin","expand","block","name","trash",3,"click",4,"ngIf"],[1,"w-1/3","m-5",3,"click","hidden"],["color","danger",1,"w-full"],["color","danger",1,"w-full",3,"disabled"],[1,"text-green-800"],[1,"text-red-800"],[1,"text-yellow-800"],[1,"text-yellow-600"],[1,"text-white"],[1,"flex","flex-row","w-full","items-end"],[1,"text-right"],[1,"flex","flex-row","justify-end","items-center"],["target","_blank",1,"",3,"href"],["alt","image",1,"w-1/2",3,"src"],["target","_blank",3,"href"],["name","document"],["color","warning"],[3,"innerHTML"],["size","large","expand","block","name","save",1,"ion-margin",3,"click"],["size","large","expand","block","name","trash",1,"ion-margin",3,"click"],["color","danger",1,"w-full",3,"click"],["color","danger",1,"w-full",3,"click","disabled"],["color","primary",1,"w-full",3,"click"]],template:function(t,i){if(1&t){const h=e.RV6();e.nrm(0,"app-header-return",1),e.j41(1,"ion-content",2)(2,"ion-grid"),e.nrm(3,"app-title",3),e.j41(4,"ion-row",4)(5,"ion-col",5)(6,"ion-card",6)(7,"ion-card-title",7),e.EFF(8),e.k0s(),e.j41(9,"ion-card-content")(10,"p",8),e.EFF(11),e.k0s()()()()(),e.j41(12,"ion-row",4)(13,"ion-col",9)(14,"ion-card",6)(15,"ion-card-title",7),e.EFF(16,"Current Status"),e.k0s(),e.DNE(17,_,3,1,"ion-card-content")(18,v,3,1,"ion-card-content"),e.k0s()(),e.j41(19,"ion-col",9)(20,"ion-card",6)(21,"ion-card-title",7),e.EFF(22,"Urgency"),e.k0s(),e.DNE(23,I,3,1,"ion-card-content")(24,C,3,1,"ion-card-content")(25,R,3,1,"ion-card-content")(26,b,3,1,"ion-card-content"),e.k0s()(),e.j41(27,"ion-col",10)(28,"ion-card",6)(29,"ion-card-title",7),e.EFF(30," Organization Impact"),e.k0s(),e.DNE(31,D,3,1,"ion-card-content")(32,M,3,1,"ion-card-content")(33,T,3,1,"ion-card-content")(34,O,3,1,"ion-card-content"),e.k0s()()(),e.nrm(35,"app-title",3),e.j41(36,"ion-row",4)(37,"ion-col",11)(38,"ion-card",6)(39,"ion-card-title",7),e.EFF(40,"Incident Commander"),e.k0s(),e.j41(41,"ion-card-content")(42,"div",12),e.nrm(43,"ion-icon",13),e.j41(44,"ion-label",8),e.EFF(45),e.k0s()()()()(),e.j41(46,"ion-col",11)(47,"ion-card",6)(48,"ion-card-title",7),e.EFF(49,"Communications Leader"),e.k0s(),e.j41(50,"ion-card-content")(51,"div",12),e.nrm(52,"ion-icon",13),e.j41(53,"ion-label",8),e.EFF(54),e.k0s()()()()(),e.j41(55,"ion-col",5)(56,"ion-card",6)(57,"ion-card-title",7),e.EFF(58,"Operations Lead"),e.k0s(),e.j41(59,"ion-card-content")(60,"div",12),e.nrm(61,"ion-icon",13),e.j41(62,"ion-label",8),e.EFF(63),e.k0s()()(),e.nrm(64,"br"),e.j41(65,"ion-card-title",7),e.EFF(66,"Operations Team"),e.k0s(),e.j41(67,"ion-card-content"),e.Z7z(68,k,4,1,"div",12,e.fX1),e.k0s()()()(),e.nrm(70,"app-title",3),e.j41(71,"ion-row",4)(72,"ion-col",5)(73,"ion-card",14),e.DNE(74,S,12,10,"ng-container",15),e.k0s()(),e.j41(75,"ion-col",5)(76,"ion-card",6)(77,"div",16)(78,"ion-textarea",17),e.mxI("ngModelChange",function(P){return e.eBV(h),e.DH7(i.newComment,P)||(i.newComment=P),e.Njj(P)}),e.k0s(),e.j41(79,"div",18)(80,"ion-icon",19),e.bIt("click",function(){e.eBV(h);const P=e.sdS(83);return e.Njj(P.click())}),e.EFF(81," Add Data "),e.j41(82,"input",20,0),e.bIt("change",function(){return e.eBV(h),e.Njj(i.onImageLoad())}),e.k0s()(),e.DNE(84,w,1,0,"ion-icon",21)(85,A,1,0,"ion-icon",22),e.k0s(),e.j41(86,"ion-button",23),e.bIt("click",function(){return e.eBV(h),e.Njj(i.addComment())}),e.EFF(87,"Add Comment"),e.k0s()()()()(),e.j41(88,"ion-row",4)(89,"ion-col",5)(90,"ion-card",6)(91,"ion-card-title",7),e.EFF(92,"Change Incident State"),e.k0s(),e.j41(93,"ion-card-content")(94,"p"),e.EFF(95,"Change the state of the incident to closed or open.Only the incident commander can change the state of the incident."),e.k0s()(),e.j41(96,"ion-card-content",16),e.DNE(97,G,2,0,"ion-button",24)(98,X,2,1,"ion-button",25),e.k0s()()(),e.DNE(99,z,10,0,"ion-col",5),e.k0s()()()}2&t&&(e.R7$(),e.Y8G("fullscreen",!0),e.R7$(2),e.Y8G("title","Incident Details"),e.R7$(5),e.JRh(i.incident.title),e.R7$(3),e.JRh(i.incident.description),e.R7$(6),e.vxM(17,"open"===i.incident.state?17:-1),e.R7$(),e.vxM(18,"closed"===i.incident.state?18:-1),e.R7$(5),e.vxM(23,"Critical"===i.incident.urgency?23:-1),e.R7$(),e.vxM(24,"High"===i.incident.urgency?24:-1),e.R7$(),e.vxM(25,"Medium"===i.incident.urgency?25:-1),e.R7$(),e.vxM(26,"Low"===i.incident.urgency?26:-1),e.R7$(5),e.vxM(31,"Extensive/Widespread"===i.incident.org_impact?31:-1),e.R7$(),e.vxM(32,"Significant/Large"===i.incident.org_impact?32:-1),e.R7$(),e.vxM(33,"Moderate/Limited"===i.incident.org_impact?33:-1),e.R7$(),e.vxM(34,"Minor/Localized"===i.incident.org_impact?34:-1),e.R7$(),e.Y8G("title","Incident Team"),e.R7$(10),e.JRh(i.incident.incidentCommander),e.R7$(9),e.JRh(i.incident.communications_lead),e.R7$(9),e.JRh(i.incident.operations_lead),e.R7$(5),e.Dyx(i.incident.operation_team),e.R7$(2),e.Y8G("title","Incident Progress"),e.R7$(4),e.Y8G("ngForOf",i.incident.report),e.R7$(4),e.Y8G("hidden",i.isImageLoaded)("autoGrow",!0),e.R50("ngModel",i.newComment),e.R7$(2),e.Y8G("hidden",i.isImageLoaded),e.R7$(4),e.Y8G("ngIf",i.isImageLoaded),e.R7$(),e.Y8G("ngIf",i.isImageLoaded),e.R7$(),e.Y8G("hidden",i.isImageLoaded),e.R7$(11),e.vxM(97,i.currentUser===i.incident.incidentCommander&&"open"===i.incident.state?97:-1),e.R7$(),e.vxM(98,i.currentUser!==i.incident.incidentCommander||"closed"===i.incident.state?98:-1),e.R7$(),e.vxM(99,"closed"===i.incident.state||"postmortem"===i.incident.state?99:-1))},dependencies:[a.Sq,a.bT,m.BC,m.vS,c.Jm,c.b_,c.I9,c.tN,c.ZB,c.hU,c.W9,c.lO,c.iq,c.he,c.ln,c.nc,c.Gw,d.W,l.p]}),p})()}];let W=(()=>{var n;class p{}return(n=p).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[f.iI.forChild(K),f.iI]}),p})();var J=r(5553);let V=(()=>{var n;class p{}return(n=p).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[a.MD,m.YN,c.bv,W,J.h]}),p})()},4796:(F,j,r)=>{r.d(j,{u:()=>u});var a=r(467),m=r(8737),c=r(4262),f=r(4438);let u=(()=>{var e;class g{constructor(s,d){this.auth=s,this.firestore=d}registerUser(s){var d=this;return(0,a.A)(function*(){try{const l=yield(0,m.eJ)(d.auth,s.email,s.password);return l.user?(yield(0,c.BN)((0,c.H9)(d.firestore,"users",l.user.uid),{email:s.email,name:s.name,orgName:s.orgName,uid:l.user.uid}),yield(0,c.BN)((0,c.H9)(d.firestore,"teams",`${s.orgName}`),{name:s.orgName,members:[l.user.uid]}),l):null}catch{return null}})()}loginUser(s){var d=this;return(0,a.A)(function*(){try{var l;const _=yield(0,m.x9)(d.auth,s.email,s.password);if(null!==(l=_.user)&&void 0!==l&&l.uid){const v=yield(0,c.x7)((0,c.H9)(d.firestore,"users",_.user.uid));if(v.exists())return localStorage.setItem("user",JSON.stringify(v.data())),_}}catch(_){console.error(_)}return null})()}logoutUser(){var s=this;return(0,a.A)(function*(){yield s.auth.signOut()})()}addMember(s){var d=this;return(0,a.A)(function*(){try{const l=yield(0,m.eJ)(d.auth,s.email,s.password);if(!l.user)return!1;const _={email:s.email,name:s.name,orgName:s.orgName,uid:l.user.uid};return yield(0,c.BN)((0,c.H9)(d.firestore,"users",l.user.uid),_),_}catch{return!1}})()}}return(e=g).\u0275fac=function(s){return new(s||e)(f.KVO(m.Nj),f.KVO(c._7))},e.\u0275prov=f.jDH({token:e,factory:e.\u0275fac,providedIn:"root"}),g})()},7473:(F,j,r)=>{r.d(j,{J:()=>e});var a=r(467),m=r(4262),c=r(4438),f=r(1626),u=r(5092);let e=(()=>{var g;class y{constructor(d,l,_){this.firestore=d,this.http=l,this.teamService=_}saveNotificationID(d,l){var _=this;return(0,a.A)(function*(){const v=(0,m.H9)(_.firestore,"users",d.uid),I=yield(0,m.x7)(v);if(I.exists()){const C=I.data();return C.notificationID=l,yield(0,m.BN)(v,C),!0}return console.log("No such document!"),!1})()}getNotificationUser(d){var l=this;return(0,a.A)(function*(){const _=(0,m.H9)(l.firestore,"users",d.uid),v=yield(0,m.x7)(_);if(v.exists()){const I=v.data();return I.notificationID?I.notificationID:""}return console.log("No such document!"),null})()}notifyIncidentToUser(d,l){var _=this;return(0,a.A)(function*(){try{const v=yield _.teamService.getTeamByOrganization(l),I=d.map(b=>b.member),C=v.filter(b=>I.includes(b.name));console.log("team",C);const R="https://devprobeapi.onrender.com/sendNotification";for(let b of C){let D=yield _.getNotificationUser(b);if(console.log("sid",D),""!==D){const T={sid:D,title:"New Incident",type:"new_incident",message:`Hey ${b.name}, you have been assigned a new incident your incident role is ${d.find(O=>O.member===b.name).role}`,target:"https://devprobe-89481.web.app/incident-manager-chooser"};yield _.http.post(R,T).toPromise(),console.log("Notification sent successfully")}else console.log("no sid")}}catch(v){console.log(v)}})()}notifyIncidentUpdateToTeam(d,l,_){var v=this;return(0,a.A)(function*(){try{const I=yield v.teamService.getTeamByOrganization(l),C=d.map(D=>D.member),R=I.filter(D=>C.includes(D.name));console.log("team",R);const b="https://devprobeapi.onrender.com/sendNotification";for(let D of R){let M=yield v.getNotificationUser(D);if(console.log("sid",M),""!==M){const O={sid:M,title:"Incident Update",type:"update_incident",message:`Hey ${D.name}, there are updates to your incident`,target:_};yield v.http.post(b,O).toPromise(),console.log("Notification sent successfully")}else console.log("no sid")}}catch(I){console.log(I)}})()}}return(g=y).\u0275fac=function(d){return new(d||g)(c.KVO(m._7),c.KVO(f.Qq),c.KVO(u.O))},g.\u0275prov=c.jDH({token:g,factory:g.\u0275fac,providedIn:"root"}),y})()},5092:(F,j,r)=>{r.d(j,{O:()=>u});var a=r(467),m=r(4262),c=r(4438),f=r(4796);let u=(()=>{var e;class g{constructor(s,d){this.firestore=s,this.authService=d}getTeamByOrganization(s){var d=this;return(0,a.A)(function*(){let l=(0,m.H9)(d.firestore,"teams",s);const I=(yield(0,m.x7)(l)).data();let C=[];for(let R=0;R<I.members.length;R++){l=(0,m.H9)(d.firestore,"users",I.members[R]);const D=(yield(0,m.x7)(l)).data();C.push(D)}return C})()}removeMember(s,d){var l=this;return(0,a.A)(function*(){try{let _=(0,m.H9)(l.firestore,"teams",s);const C=(yield(0,m.x7)(_)).data();let R=C.members.filter(D=>D!==d);return yield(0,m.BN)(_,{name:C.name,members:R}),_=(0,m.H9)(l.firestore,"users",d),yield(0,m.BN)(_,{}),yield l.authService,!0}catch{return!1}})()}addMember(s){var d=this;return(0,a.A)(function*(){try{const l=yield d.authService.addMember(s);if(!l)return!1;const _=(0,m.H9)(d.firestore,"teams",s.orgName),I=(yield(0,m.x7)(_)).data();console.log(I);const C=I;let R=C.members;return R.push(l.uid),console.log(R),yield(0,m.mZ)(_,{name:C.name,members:R}),l.uid}catch{return!1}})()}}return(e=g).\u0275fac=function(s){return new(s||e)(c.KVO(m._7),c.KVO(f.u))},e.\u0275prov=c.jDH({token:e,factory:e.\u0275fac,providedIn:"root"}),g})()}}]);