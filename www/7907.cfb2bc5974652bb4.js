"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7907],{5553:(P,I,o)=>{o.d(I,{h:()=>g});var l=o(177),m=o(7863),r=o(4438);let g=(()=>{var _;class e{}return(_=e).\u0275fac=function(v){return new(v||_)},_.\u0275mod=r.$C({type:_}),_.\u0275inj=r.G2t({imports:[l.MD,m.bv]}),e})()},3241:(P,I,o)=>{o.d(I,{p:()=>g});var l=o(4438),m=o(177),r=o(7863);let g=(()=>{var _;class e{constructor(v){this.location=v,this.title="Header Title"}ngOnInit(){}goBack(){this.location.back()}}return(_=e).\u0275fac=function(v){return new(v||_)(l.rXU(m.aZ))},_.\u0275cmp=l.VBU({type:_,selectors:[["app-header-return"]],inputs:{title:"title"},decls:6,vars:2,consts:[[3,"translucent"],["slot","start","menu","menu-id"],["name","arrow-back","slot","start",1,"p-4","bigger-icon",3,"click"]],template:function(v,a){1&v&&(l.j41(0,"ion-header",0)(1,"ion-toolbar"),l.nrm(2,"ion-menu-button",1),l.j41(3,"ion-icon",2),l.bIt("click",function(){return a.goBack()}),l.k0s(),l.j41(4,"ion-title"),l.EFF(5),l.k0s()()()),2&v&&(l.Y8G("translucent",!0),l.R7$(5),l.JRh(a.title))},dependencies:[r.eU,r.iq,r.MC,r.BC,r.ai],styles:[".bigger-icon[_ngcontent-%COMP%]{font-size:1.5em}"]}),e})()},8453:(P,I,o)=>{o.d(I,{W:()=>r});var l=o(4438),m=o(7863);let r=(()=>{var g;class _{constructor(){this.title="Title"}ngOnInit(){}}return(g=_).\u0275fac=function(p){return new(p||g)},g.\u0275cmp=l.VBU({type:g,selectors:[["app-title"]],inputs:{title:"title"},decls:4,vars:1,consts:[[1,"lg:m-10"],["size","12","size-md","6","size-lg","6"],[1,"text-4xl","lg:text-6xl","font-bold"]],template:function(p,v){1&p&&(l.j41(0,"ion-row",0)(1,"ion-col",1)(2,"h1",2),l.EFF(3),l.k0s()()()),2&p&&(l.R7$(3),l.JRh(v.title))},dependencies:[m.hU,m.ln]}),_})()},7907:(P,I,o)=>{o.r(I),o.d(I,{IncidentDetailsPageModule:()=>B});var l=o(177),m=o(4341),r=o(7863),g=o(7650),_=o(467),e=o(4438),p=o(4624),v=o(7473),a=o(8453),d=o(3241);function s(t,f){if(1&t&&(e.j41(0,"ion-card-content")(1,"ion-label",21),e.EFF(2),e.k0s()()),2&t){const c=e.XpG();e.R7$(2),e.JRh(c.incident.state.toUpperCase())}}function u(t,f){if(1&t&&(e.j41(0,"ion-card-content")(1,"ion-label",22),e.EFF(2),e.k0s()()),2&t){const c=e.XpG();e.R7$(2),e.JRh(c.incident.state.toLocaleUpperCase())}}function h(t,f){if(1&t&&(e.j41(0,"ion-card-content")(1,"ion-label",22),e.EFF(2),e.k0s()()),2&t){const c=e.XpG();e.R7$(2),e.JRh(c.incident.urgency.toUpperCase())}}function E(t,f){if(1&t&&(e.j41(0,"ion-card-content")(1,"ion-label",23),e.EFF(2),e.k0s()()),2&t){const c=e.XpG();e.R7$(2),e.JRh(c.incident.urgency.toUpperCase())}}function C(t,f){if(1&t&&(e.j41(0,"ion-card-content")(1,"ion-label",24),e.EFF(2),e.k0s()()),2&t){const c=e.XpG();e.R7$(2),e.JRh(c.incident.urgency.toUpperCase())}}function D(t,f){if(1&t&&(e.j41(0,"ion-card-content")(1,"ion-label",21),e.EFF(2),e.k0s()()),2&t){const c=e.XpG();e.R7$(2),e.JRh(c.incident.urgency.toUpperCase())}}function y(t,f){if(1&t&&(e.j41(0,"ion-card-content")(1,"ion-label",22),e.EFF(2),e.k0s()()),2&t){const c=e.XpG();e.R7$(2),e.JRh(c.incident.org_impact.toUpperCase())}}function R(t,f){if(1&t&&(e.j41(0,"ion-card-content")(1,"ion-label",23),e.EFF(2),e.k0s()()),2&t){const c=e.XpG();e.R7$(2),e.JRh(c.incident.org_impact.toUpperCase())}}function b(t,f){if(1&t&&(e.j41(0,"ion-card-content")(1,"ion-label",24),e.EFF(2),e.k0s()()),2&t){const c=e.XpG();e.R7$(2),e.JRh(c.incident.org_impact.toUpperCase())}}function F(t,f){if(1&t&&(e.j41(0,"ion-card-content")(1,"ion-label",21),e.EFF(2),e.k0s()()),2&t){const c=e.XpG();e.R7$(2),e.JRh(c.incident.org_impact.toUpperCase())}}function j(t,f){if(1&t&&(e.j41(0,"div",11),e.nrm(1,"ion-icon",12),e.j41(2,"ion-label",7),e.EFF(3),e.k0s()()),2&t){const c=f.$implicit;e.R7$(3),e.JRh(c)}}function T(t,f){if(1&t&&(e.qex(0),e.j41(1,"ion-card",25)(2,"ion-card-content"),e.nrm(3,"p",26),e.k0s(),e.j41(4,"ion-card-content",27)(5,"div",28),e.nrm(6,"ion-icon",12),e.j41(7,"ion-label",7),e.EFF(8),e.k0s()()()(),e.bVm()),2&t){const c=f.$implicit,n=e.XpG();e.R7$(),e.AVh("self-end",c.from===n.currentUser)("bg-gray-600",c.from===n.currentUser)("self-start",c.from!==n.currentUser)("bg-gray-800",c.from!==n.currentUser),e.R7$(2),e.Y8G("innerHTML",c.comment,e.npT),e.R7$(5),e.JRh(c.from)}}function U(t,f){if(1&t){const c=e.RV6();e.j41(0,"ion-button",29),e.bIt("click",function(){e.eBV(c);const i=e.XpG();return e.Njj(i.closeIncident())}),e.EFF(1,"Close Incident"),e.k0s()}}function x(t,f){if(1&t){const c=e.RV6();e.j41(0,"ion-button",30),e.bIt("click",function(){e.eBV(c);const i=e.XpG();return e.Njj(i.closeIncident())}),e.EFF(1,"Close Incident"),e.k0s()}2&t&&e.Y8G("disabled",!0)}function N(t,f){if(1&t){const c=e.RV6();e.j41(0,"ion-col",4)(1,"ion-card",5)(2,"ion-card-title",6),e.EFF(3,"Go to Incident Postmortem"),e.k0s(),e.j41(4,"ion-card-content")(5,"p"),e.EFF(6,"Postmortem Culture: Learning from Failure. The postmortem is a retrospective of the incident, focusing on what went wrong, what can be learned, and how to prevent similar incidents in the future."),e.k0s()(),e.j41(7,"ion-card-content",18)(8,"ion-button",31),e.bIt("click",function(){e.eBV(c);const i=e.XpG();return e.Njj(i.closeIncident())}),e.EFF(9,"Incident Postmortem"),e.k0s()()()()}}const $=[{path:"",component:(()=>{var t;class f{constructor(n,i,M,O,w){this.router=n,this.activatedRoute=i,this.loadingCtrl=M,this.incidentService=O,this.notificationService=w,this.productStep="",this.productObjective="",this.orgName="",this.currentUser="",this.incident={},this.newComment=""}ngOnInit(){}ionViewWillEnter(){this.getParams()}getParams(){this.activatedRoute.params.subscribe(i=>{this.productObjective=i.productObjective,this.productStep=i.step,this.incident=JSON.parse(i.incident)});const n=JSON.parse(localStorage.getItem("user"));this.orgName=n.orgName,this.currentUser=n.name,console.log(this.orgName),console.log(this.productObjective),console.log(this.productStep),console.log(this.incident.title)}addComment(){var n=this;return(0,_.A)(function*(){if(yield n.showLoading(),console.log("add comment"),console.log(n.currentUser),console.log(n.newComment),""===n.newComment)return;n.incident.report?n.incident.report.push({comment:n.newComment.replace(/\n/g,"<br>"),from:n.currentUser}):n.incident.report=[{comment:n.newComment.replace(/\n/g,"<br>"),from:n.currentUser}],yield n.incidentService.updateIncident(n.orgName,n.productObjective,n.productStep,n.incident);let i=[];i.push({role:"Incident Commander",member:n.incident.incidentCommander}),i.push({role:"Communications Lead",member:n.incident.communications_lead}),i.push({role:"Operations Lead",member:n.incident.operations_lead});for(let M=0;M<n.incident.operation_team.length;M++)i.push({role:"Operations Team Member",member:n.incident.operation_team[M]});console.log(i),yield n.notificationService.notifyIncidentUpdateToTeam(i,n.orgName),n.newComment="",n.hideLoading()})()}closeIncident(){}showLoading(){var n=this;return(0,_.A)(function*(){yield(yield n.loadingCtrl.create({})).present()})()}hideLoading(){var n=this;return(0,_.A)(function*(){yield n.loadingCtrl.dismiss()})()}}return(t=f).\u0275fac=function(n){return new(n||t)(e.rXU(g.Ix),e.rXU(g.nX),e.rXU(r.Xi),e.rXU(p.I),e.rXU(v.J))},t.\u0275cmp=e.VBU({type:t,selectors:[["app-incident-details"]],decls:93,vars:25,consts:[["title","Incident Details"],[3,"fullscreen"],[3,"title"],[1,"lg:m-10","md:m-10"],["size","12","size-md","12","size-lg","12",1,""],[1,"p-5","flex","flex-col","justify-center","items-center"],[1,"text-2xl"],[1,""],["size","6","size-md","4","size-lg","4",1,""],["size","12","size-md","4","size-lg","4",1,""],["size","6","size-md","6","size-lg","6",1,""],[1,"flex","flex-row","justify-center","items-center"],["name","person-circle",1,"text-2xl"],[1,"p-5","flex","flex-col","justify-center","items-start"],[4,"ngFor","ngForOf"],[1,"flex","flex-row","justify-center","w-full"],["placeholder","Add a comment","type","text",1,"w-2/3",3,"ngModelChange","autoGrow","ngModel"],["color","success",1,"w-1/3","m-5",3,"click"],[1,"flex","flex-row","justify-center","items-center","w-full"],["color","danger",1,"w-full"],["color","danger",1,"w-full",3,"disabled"],[1,"text-green-800"],[1,"text-red-800"],[1,"text-yellow-800"],[1,"text-yellow-600"],[1,"text-white"],[1,"",3,"innerHTML"],[1,"text-right"],[1,"flex","flex-row","justify-end","items-center"],["color","danger",1,"w-full",3,"click"],["color","danger",1,"w-full",3,"click","disabled"],["color","primary",1,"w-full",3,"click"]],template:function(n,i){1&n&&(e.nrm(0,"app-header-return",0),e.j41(1,"ion-content",1)(2,"ion-grid"),e.nrm(3,"app-title",2),e.j41(4,"ion-row",3)(5,"ion-col",4)(6,"ion-card",5)(7,"ion-card-title",6),e.EFF(8),e.k0s(),e.j41(9,"ion-card-content")(10,"p",7),e.EFF(11),e.k0s()()()()(),e.j41(12,"ion-row",3)(13,"ion-col",8)(14,"ion-card",5)(15,"ion-card-title",6),e.EFF(16,"Current Status"),e.k0s(),e.DNE(17,s,3,1,"ion-card-content")(18,u,3,1,"ion-card-content"),e.k0s()(),e.j41(19,"ion-col",8)(20,"ion-card",5)(21,"ion-card-title",6),e.EFF(22,"Urgency"),e.k0s(),e.DNE(23,h,3,1,"ion-card-content")(24,E,3,1,"ion-card-content")(25,C,3,1,"ion-card-content")(26,D,3,1,"ion-card-content"),e.k0s()(),e.j41(27,"ion-col",9)(28,"ion-card",5)(29,"ion-card-title",6),e.EFF(30," Organization Impact"),e.k0s(),e.DNE(31,y,3,1,"ion-card-content")(32,R,3,1,"ion-card-content")(33,b,3,1,"ion-card-content")(34,F,3,1,"ion-card-content"),e.k0s()()(),e.nrm(35,"app-title",2),e.j41(36,"ion-row",3)(37,"ion-col",10)(38,"ion-card",5)(39,"ion-card-title",6),e.EFF(40,"Incident Commander"),e.k0s(),e.j41(41,"ion-card-content")(42,"div",11),e.nrm(43,"ion-icon",12),e.j41(44,"ion-label",7),e.EFF(45),e.k0s()()()()(),e.j41(46,"ion-col",10)(47,"ion-card",5)(48,"ion-card-title",6),e.EFF(49,"Communications Leader"),e.k0s(),e.j41(50,"ion-card-content")(51,"div",11),e.nrm(52,"ion-icon",12),e.j41(53,"ion-label",7),e.EFF(54),e.k0s()()()()(),e.j41(55,"ion-col",4)(56,"ion-card",5)(57,"ion-card-title",6),e.EFF(58,"Operations Lead"),e.k0s(),e.j41(59,"ion-card-content")(60,"div",11),e.nrm(61,"ion-icon",12),e.j41(62,"ion-label",7),e.EFF(63),e.k0s()()(),e.nrm(64,"br"),e.j41(65,"ion-card-title",6),e.EFF(66,"Operations Team"),e.k0s(),e.j41(67,"ion-card-content"),e.Z7z(68,j,4,1,"div",11,e.fX1),e.k0s()()()(),e.nrm(70,"app-title",2),e.j41(71,"ion-row",3)(72,"ion-col",4)(73,"ion-card",13),e.DNE(74,T,9,10,"ng-container",14),e.k0s()(),e.j41(75,"ion-col",4)(76,"ion-card",5)(77,"div",15)(78,"ion-textarea",16),e.mxI("ngModelChange",function(O){return e.DH7(i.newComment,O)||(i.newComment=O),O}),e.k0s(),e.j41(79,"ion-button",17),e.bIt("click",function(){return i.addComment()}),e.EFF(80,"Add Comment"),e.k0s()()()()(),e.j41(81,"ion-row",3)(82,"ion-col",4)(83,"ion-card",5)(84,"ion-card-title",6),e.EFF(85,"Change Incident State"),e.k0s(),e.j41(86,"ion-card-content")(87,"p"),e.EFF(88,"Change the state of the incident to closed or open.Only the incident commander can change the state of the incident."),e.k0s()(),e.j41(89,"ion-card-content",18),e.DNE(90,U,2,0,"ion-button",19)(91,x,2,1,"ion-button",20),e.k0s()()(),e.DNE(92,N,10,0,"ion-col",4),e.k0s()()()),2&n&&(e.R7$(),e.Y8G("fullscreen",!0),e.R7$(2),e.Y8G("title","Incident Details"),e.R7$(5),e.JRh(i.incident.title),e.R7$(3),e.JRh(i.incident.description),e.R7$(6),e.vxM(17,"open"===i.incident.state?17:-1),e.R7$(),e.vxM(18,"closed"===i.incident.state?18:-1),e.R7$(5),e.vxM(23,"Critical"===i.incident.urgency?23:-1),e.R7$(),e.vxM(24,"High"===i.incident.urgency?24:-1),e.R7$(),e.vxM(25,"Medium"===i.incident.urgency?25:-1),e.R7$(),e.vxM(26,"Low"===i.incident.urgency?26:-1),e.R7$(5),e.vxM(31,"Extensive/Widespread"===i.incident.org_impact?31:-1),e.R7$(),e.vxM(32,"Significant/Large"===i.incident.org_impact?32:-1),e.R7$(),e.vxM(33,"Moderate/Limited"===i.incident.org_impact?33:-1),e.R7$(),e.vxM(34,"Minor/Localized"===i.incident.org_impact?34:-1),e.R7$(),e.Y8G("title","Incident Team"),e.R7$(10),e.JRh(i.incident.incidentCommander),e.R7$(9),e.JRh(i.incident.communications_lead),e.R7$(9),e.JRh(i.incident.operations_lead),e.R7$(5),e.Dyx(i.incident.operation_team),e.R7$(2),e.Y8G("title","Incident Progress"),e.R7$(4),e.Y8G("ngForOf",i.incident.report),e.R7$(4),e.Y8G("autoGrow",!0),e.R50("ngModel",i.newComment),e.R7$(12),e.vxM(90,i.currentUser===i.incident.incidentCommander&&"open"===i.incident.state?90:-1),e.R7$(),e.vxM(91,i.currentUser!==i.incident.incidentCommander||"closed"===i.incident.state?91:-1),e.R7$(),e.vxM(92,"closed"===i.incident.state?92:-1))},dependencies:[l.Sq,m.BC,m.vS,r.Jm,r.b_,r.I9,r.tN,r.hU,r.W9,r.lO,r.iq,r.he,r.ln,r.nc,r.Gw,a.W,d.p]}),f})()}];let k=(()=>{var t;class f{}return(t=f).\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.$C({type:t}),t.\u0275inj=e.G2t({imports:[g.iI.forChild($),g.iI]}),f})();var A=o(5553);let B=(()=>{var t;class f{}return(t=f).\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.$C({type:t}),t.\u0275inj=e.G2t({imports:[l.MD,m.YN,r.bv,k,A.h]}),f})()},4796:(P,I,o)=>{o.d(I,{u:()=>_});var l=o(467),m=o(8737),r=o(4262),g=o(4438);let _=(()=>{var e;class p{constructor(a,d){this.auth=a,this.firestore=d}registerUser(a){var d=this;return(0,l.A)(function*(){try{const s=yield(0,m.eJ)(d.auth,a.email,a.password);return s.user?(yield(0,r.BN)((0,r.H9)(d.firestore,"users",s.user.uid),{email:a.email,name:a.name,orgName:a.orgName,uid:s.user.uid}),yield(0,r.BN)((0,r.H9)(d.firestore,"teams",`${a.orgName}`),{name:a.orgName,members:[s.user.uid]}),s):null}catch{return null}})()}loginUser(a){var d=this;return(0,l.A)(function*(){try{var s;const u=yield(0,m.x9)(d.auth,a.email,a.password);if(null!==(s=u.user)&&void 0!==s&&s.uid){const h=yield(0,r.x7)((0,r.H9)(d.firestore,"users",u.user.uid));if(h.exists())return localStorage.setItem("user",JSON.stringify(h.data())),u}}catch(u){console.error(u)}return null})()}logoutUser(){var a=this;return(0,l.A)(function*(){yield a.auth.signOut()})()}addMember(a){var d=this;return(0,l.A)(function*(){try{const s=yield(0,m.eJ)(d.auth,a.email,a.password);if(!s.user)return!1;const u={email:a.email,name:a.name,orgName:a.orgName,uid:s.user.uid};return yield(0,r.BN)((0,r.H9)(d.firestore,"users",s.user.uid),u),u}catch{return!1}})()}}return(e=p).\u0275fac=function(a){return new(a||e)(g.KVO(m.Nj),g.KVO(r._7))},e.\u0275prov=g.jDH({token:e,factory:e.\u0275fac,providedIn:"root"}),p})()},7473:(P,I,o)=>{o.d(I,{J:()=>e});var l=o(467),m=o(4262),r=o(4438),g=o(1626),_=o(5092);let e=(()=>{var p;class v{constructor(d,s,u){this.firestore=d,this.http=s,this.teamService=u}saveNotificationID(d,s){var u=this;return(0,l.A)(function*(){const h=(0,m.H9)(u.firestore,"users",d.uid),E=yield(0,m.x7)(h);if(E.exists()){const C=E.data();return C.notificationID=s,yield(0,m.BN)(h,C),!0}return console.log("No such document!"),!1})()}getNotificationUser(d){var s=this;return(0,l.A)(function*(){const u=(0,m.H9)(s.firestore,"users",d.uid),h=yield(0,m.x7)(u);if(h.exists()){const E=h.data();return E.notificationID?E.notificationID:""}return console.log("No such document!"),null})()}notifyIncidentToUser(d,s){var u=this;return(0,l.A)(function*(){try{const h=yield u.teamService.getTeamByOrganization(s),E=d.map(y=>y.member),C=h.filter(y=>E.includes(y.name));console.log("team",C);const D="https://devprobeapi.onrender.com/sendNotification";for(let y of C){let R=yield u.getNotificationUser(y);if(console.log("sid",R),""!==R){const F={sid:R,title:"New Incident",type:"new_incident",message:`Hey ${y.name}, you have been assigned a new incident your incident role is ${d.find(j=>j.member===y.name).role}`,target:"https://devprobe-89481.web.app/incident-manager-chooser"};yield u.http.post(D,F).toPromise(),console.log("Notification sent successfully")}else console.log("no sid")}}catch(h){console.log(h)}})()}notifyIncidentUpdateToTeam(d,s){var u=this;return(0,l.A)(function*(){try{const h=yield u.teamService.getTeamByOrganization(s),E=d.map(y=>y.member),C=h.filter(y=>E.includes(y.name));console.log("team",C);const D="https://devprobeapi.onrender.com/sendNotification";for(let y of C){let R=yield u.getNotificationUser(y);if(console.log("sid",R),""!==R){const F={sid:R,title:"Incident Update",type:"update_incident",message:`Hey ${y.name}, there are updates to your incident`,target:"https://devprobe-89481.web.app/incident-manager-chooser"};yield u.http.post(D,F).toPromise(),console.log("Notification sent successfully")}else console.log("no sid")}}catch(h){console.log(h)}})()}}return(p=v).\u0275fac=function(d){return new(d||p)(r.KVO(m._7),r.KVO(g.Qq),r.KVO(_.O))},p.\u0275prov=r.jDH({token:p,factory:p.\u0275fac,providedIn:"root"}),v})()},5092:(P,I,o)=>{o.d(I,{O:()=>_});var l=o(467),m=o(4262),r=o(4438),g=o(4796);let _=(()=>{var e;class p{constructor(a,d){this.firestore=a,this.authService=d}getTeamByOrganization(a){var d=this;return(0,l.A)(function*(){let s=(0,m.H9)(d.firestore,"teams",a);const E=(yield(0,m.x7)(s)).data();let C=[];for(let D=0;D<E.members.length;D++){s=(0,m.H9)(d.firestore,"users",E.members[D]);const R=(yield(0,m.x7)(s)).data();C.push(R)}return C})()}removeMember(a,d){var s=this;return(0,l.A)(function*(){try{let u=(0,m.H9)(s.firestore,"teams",a);const C=(yield(0,m.x7)(u)).data();let D=C.members.filter(R=>R!==d);return yield(0,m.BN)(u,{name:C.name,members:D}),u=(0,m.H9)(s.firestore,"users",d),yield(0,m.BN)(u,{}),yield s.authService,!0}catch{return!1}})()}addMember(a){var d=this;return(0,l.A)(function*(){try{const s=yield d.authService.addMember(a);if(!s)return!1;const u=(0,m.H9)(d.firestore,"teams",a.orgName),E=(yield(0,m.x7)(u)).data();console.log(E);const C=E;let D=C.members;return D.push(s.uid),console.log(D),yield(0,m.mZ)(u,{name:C.name,members:D}),s.uid}catch{return!1}})()}}return(e=p).\u0275fac=function(a){return new(a||e)(r.KVO(m._7),r.KVO(g.u))},e.\u0275prov=r.jDH({token:e,factory:e.\u0275fac,providedIn:"root"}),p})()}}]);