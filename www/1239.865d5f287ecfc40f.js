"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1239],{1239:(b,v,d)=>{d.r(v),d.d(v,{LatencyTestPageModule:()=>O});var R=d(177),L=d(4341),a=d(7863),m=d(305),g=d(467),e=d(4438),T=d(9640),f=d(4262),F=d(1626);let j=(()=>{var i;class u{constructor(t,o){this.firestore=t,this.http=o,this.ipApiURL="https://cors-ea3m.onrender.com/http://ip-api.com/json/"}getLocation(t){var o=this;return(0,g.A)(function*(){console.log(t);const n=yield o.http.get(o.ipApiURL+t[0].dst_addr).toPromise();for(let c=0;c<t.length;c++)t[c].toLatitude=n.lat,t[c].toLongitude=n.lon,t[c].cityTo=n.city,t[c].countryTo=n.country;const r=t.map(c=>o.http.get(o.ipApiURL+c.from).toPromise());return(yield Promise.all(r)).forEach((c,h)=>{t[h].fromLatitude=c.lat,t[h].fromLongitude=c.lon,t[h].cityFrom=c.city,t[h].countryFrom=c.country}),console.log(t),t})()}saveLocationResults(t,o,s,n){var r=this;return(0,g.A)(function*(){try{console.log(n,"ripeData");const p=(0,f.rJ)(r.firestore,"teams",t,"products",o,"ripe"),c=(0,f.H9)(p,s),h=n.map(y=>({from:y.from,dst_addr:y.dst_addr,latency:y.latency,cityFrom:y.cityFrom,countryFrom:y.countryFrom,cityTo:y.cityTo,countryTo:y.countryTo,fromLatitude:y.fromLatitude,fromLongitude:y.fromLongitude,toLatitude:y.toLatitude,toLongitude:y.toLongitude}));return yield(0,f.BN)(c,{data:h}),console.log("Data saved",{data:h}),!0}catch(p){return console.log(p),!1}})()}}return(i=u).\u0275fac=function(t){return new(t||i)(e.KVO(f._7),e.KVO(F.Qq))},i.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),u})();var P=d(8453),S=d(3241);function M(i,u){if(1&i&&(e.j41(0,"ion-item")(1,"ion-label"),e.EFF(2),e.k0s(),e.j41(3,"ion-label"),e.EFF(4),e.k0s(),e.j41(5,"ion-label"),e.EFF(6),e.k0s()()),2&i){const l=u.$implicit;e.R7$(2),e.Lme("FROM ",l.cityFrom,",",l.countryFrom,""),e.R7$(2),e.SpI("",l.latency," ms"),e.R7$(2),e.Lme(" TO ",l.cityTo,",",l.countryTo,"")}}function _(i,u){if(1&i){const l=e.RV6();e.j41(0,"ion-item",15),e.bIt("click",function(){const o=e.eBV(l).$implicit,s=e.XpG();return e.Njj(s.viewHistory(o))}),e.j41(1,"ion-label"),e.EFF(2),e.k0s(),e.nrm(3,"ion-icon",16),e.k0s()}if(2&i){const l=u.$implicit;e.R7$(2),e.JRh(l)}}const w=[{path:"",component:(()=>{var i;class u{constructor(t,o,s,n,r,p){this.ripeService=t,this.loadingCtrl=o,this.locationService=s,this.route=n,this.alertCtrl=r,this.router=p,this.user={},this.orgName="",this.productObjective="",this.productStep="",this.host="portfoliojuanfranciscocisneros.web.app",this.description="NEW IONIC",this.type="ping",this.ripeResults=[],this.ripeHistoryResultsID=[]}ngOnInit(){}ionViewWillEnter(){var t=this;return(0,g.A)(function*(){yield t.showLoading(),t.route.params.subscribe(s=>{t.productObjective=s.productObjective,t.productStep=s.step;const n=new Date,r=n.getDate()+"-"+(n.getMonth()+1)+"-"+n.getFullYear()+"-"+n.getHours()+":"+n.getMinutes()+":"+n.getSeconds();t.description=s.productObjective+"-"+s.step+"-"+r});const o=localStorage.getItem("user");o&&(t.user=JSON.parse(o),t.orgName=t.user.orgName,yield t.getHistoryResults(t.orgName,t.productObjective),yield t.hideLoading())})()}sendRequest(){var t=this;return(0,g.A)(function*(){yield t.showLoading();const o=yield t.ripeService.sendMeasurementRequest(t.host,t.description,t.type);yield t.hideLoading();const s=!1!==o?`Test sent, please wait a few minutes to GET RESULTS for ID: ${o}`:"Test not sent",n=!1!==o?"Success":"Error";yield t.showAlert(s,n)})()}getResults(){var t=this;return(0,g.A)(function*(){yield t.showLoading(),t.ripeResults=[];try{let o=yield t.ripeService.getMeasurementResults();if(!o)return yield t.hideLoading(),void(yield t.showAlert("Please send a test first","Error"));o.subscribe(function(){var s=(0,g.A)(function*(n){if(0===n.length)return yield t.hideLoading(),void(yield t.showAlert("No data found yet","Please wait a few minutes and try again"));for(let r=0;r<n.length;r++)t.ripeResults.push({latency:n[r].avg,dst_addr:n[r].dst_addr,from:n[r].from,toLatitude:0,toLongitude:0,fromLatitude:0,fromLongitude:0,cityTo:"",countryTo:"",cityFrom:"",countryFrom:""});yield t.ripeService.saveMeasurementResults(t.orgName,t.productObjective,t.description,t.ripeResults).then((0,g.A)(function*(){yield t.locationService.getLocation(t.ripeResults).then(r=>{t.ripeResults=r,t.locationService.saveLocationResults(t.orgName,t.productObjective,t.description,r).then(function(){var p=(0,g.A)(function*(c){c&&(yield t.getHistoryResults(t.orgName,t.productObjective),yield t.hideLoading(),yield t.showAlert("Data saved and Showing Results","Success"))});return function(c){return p.apply(this,arguments)}}())})}))});return function(n){return s.apply(this,arguments)}}())}catch{yield t.hideLoading(),yield t.showAlert("Error getting results","Error")}})()}handleChange(t){this.type=t.detail.value}getHistoryResults(t,o){var s=this;return(0,g.A)(function*(){s.ripeHistoryResultsID=[];const n=yield s.ripeService.getHistoryResults(t,o);for(let r=0;r<n.length;r++)n[r].id.split("-")[1]===s.productStep&&s.ripeHistoryResultsID.push(n[r].id)})()}showLoading(){var t=this;return(0,g.A)(function*(){yield(yield t.loadingCtrl.create({})).present()})()}hideLoading(){var t=this;return(0,g.A)(function*(){yield t.loadingCtrl.dismiss()})()}showAlert(t,o){var s=this;return(0,g.A)(function*(){yield(yield s.alertCtrl.create({header:o,message:t,buttons:["OK"]})).present()})()}viewHistory(t){var o=this;return(0,g.A)(function*(){yield o.router.navigate(["/latency-results"],{queryParams:{description:t,productObjective:o.productObjective,step:o.productStep}})})()}}return(i=u).\u0275fac=function(t){return new(t||i)(e.rXU(T.Q),e.rXU(a.Xi),e.rXU(j),e.rXU(m.nX),e.rXU(a.hG),e.rXU(m.Ix))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-latency-test"]],inputs:{host:"host",description:"description"},decls:33,vars:9,consts:[[3,"title"],[3,"fullscreen"],[1,"lg:m-10","md:m-10"],["size","12","size-md","4","size-lg","4",1,""],["label","Host Name","placeholder","Enter a host name","type","text","labelPlacement","stacked",1,"",3,"ngModelChange","ngModel"],["size","12","size-md","4","size-lg","4"],["readonly","true","label","Description","placeholder","Enter a description","type","text","labelPlacement","stacked",1,"",3,"ngModelChange","ngModel"],[3,"ionChange"],["value","ping"],["value","traceroute"],["size","12","size-md","12","size-lg","12",1,"flex","flex-row","justify-end"],["color","primary",1,"",3,"click"],["size","12","size-md","12","size-lg","12"],[4,"ngFor","ngForOf"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["name","arrow-forward","color","primary"]],template:function(t,o){1&t&&(e.nrm(0,"app-header-return",0),e.j41(1,"ion-content",1)(2,"ion-grid"),e.nrm(3,"app-title",0),e.j41(4,"ion-row",2)(5,"ion-col",3)(6,"ion-input",4),e.mxI("ngModelChange",function(n){return e.DH7(o.host,n)||(o.host=n),n}),e.k0s()(),e.j41(7,"ion-col",5)(8,"ion-input",6),e.mxI("ngModelChange",function(n){return e.DH7(o.description,n)||(o.description=n),n}),e.k0s()(),e.j41(9,"ion-col",5)(10,"ion-list")(11,"ion-item")(12,"ion-select",7),e.bIt("ionChange",function(n){return o.handleChange(n)}),e.j41(13,"ion-select-option",8),e.EFF(14,"Ping"),e.k0s(),e.j41(15,"ion-select-option",9),e.EFF(16,"Traceroute"),e.k0s()()()()()(),e.j41(17,"ion-row",2)(18,"ion-col",10)(19,"ion-button",11),e.bIt("click",function(){return o.sendRequest()}),e.EFF(20,"Add Test"),e.k0s(),e.j41(21,"ion-button",11),e.bIt("click",function(){return o.getResults()}),e.EFF(22,"Get Results"),e.k0s()()(),e.nrm(23,"app-title",0),e.j41(24,"ion-row",2)(25,"ion-col",12)(26,"ion-list"),e.DNE(27,M,7,5,"ion-item",13),e.k0s()()(),e.nrm(28,"app-title",0),e.j41(29,"ion-row",2)(30,"ion-col",12)(31,"ion-list"),e.DNE(32,_,4,1,"ion-item",14),e.k0s()()()()()),2&t&&(e.Y8G("title","Latency Test"),e.R7$(),e.Y8G("fullscreen",!0),e.R7$(2),e.Y8G("title","New Latency Test"),e.R7$(3),e.R50("ngModel",o.host),e.R7$(2),e.R50("ngModel",o.description),e.R7$(15),e.Y8G("title","Test Results"),e.R7$(4),e.Y8G("ngForOf",o.ripeResults),e.R7$(),e.Y8G("title","Test Results History"),e.R7$(4),e.Y8G("ngForOf",o.ripeHistoryResultsID))},dependencies:[R.Sq,L.BC,L.vS,a.Jm,a.hU,a.W9,a.lO,a.iq,a.$w,a.uz,a.he,a.nf,a.ln,a.Nm,a.Ip,a.Je,a.Gw,P.W,S.p]}),u})()}];let A=(()=>{var i;class u{}return(i=u).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[m.iI.forChild(w),m.iI]}),u})();var C=d(5553);let O=(()=>{var i;class u{}return(i=u).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[R.MD,L.YN,a.bv,A,C.h]}),u})()}}]);