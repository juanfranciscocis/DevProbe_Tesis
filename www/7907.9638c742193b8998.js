"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7907],{5553:(O,j,r)=>{r.d(j,{h:()=>v});var s=r(177),m=r(7863),c=r(4438);let v=(()=>{var _;class e{}return(_=e).\u0275fac=function(C){return new(C||_)},_.\u0275mod=c.$C({type:_}),_.\u0275inj=c.G2t({imports:[s.MD,m.bv]}),e})()},3241:(O,j,r)=>{r.d(j,{p:()=>v});var s=r(4438),m=r(177),c=r(7863);let v=(()=>{var _;class e{constructor(C){this.location=C,this.title="Header Title"}ngOnInit(){}goBack(){this.location.back()}}return(_=e).\u0275fac=function(C){return new(C||_)(s.rXU(m.aZ))},_.\u0275cmp=s.VBU({type:_,selectors:[["app-header-return"]],inputs:{title:"title"},decls:6,vars:2,consts:[[3,"translucent"],["slot","start","menu","menu-id"],["name","arrow-back","slot","start",1,"p-4","bigger-icon",3,"click"]],template:function(C,l){1&C&&(s.j41(0,"ion-header",0)(1,"ion-toolbar"),s.nrm(2,"ion-menu-button",1),s.j41(3,"ion-icon",2),s.bIt("click",function(){return l.goBack()}),s.k0s(),s.j41(4,"ion-title"),s.EFF(5),s.k0s()()()),2&C&&(s.Y8G("translucent",!0),s.R7$(5),s.JRh(l.title))},dependencies:[c.eU,c.iq,c.MC,c.BC,c.ai],styles:[".bigger-icon[_ngcontent-%COMP%]{font-size:1.5em}"]}),e})()},8453:(O,j,r)=>{r.d(j,{W:()=>c});var s=r(4438),m=r(7863);let c=(()=>{var v;class _{constructor(){this.title="Title"}ngOnInit(){}}return(v=_).\u0275fac=function(g){return new(g||v)},v.\u0275cmp=s.VBU({type:v,selectors:[["app-title"]],inputs:{title:"title"},decls:4,vars:1,consts:[[1,"lg:m-10"],["size","12","size-md","6","size-lg","6"],[1,"text-4xl","lg:text-6xl","font-bold"]],template:function(g,C){1&g&&(s.j41(0,"ion-row",0)(1,"ion-col",1)(2,"h1",2),s.EFF(3),s.k0s()()()),2&g&&(s.R7$(3),s.JRh(C.title))},dependencies:[m.hU,m.ln]}),_})()},7907:(O,j,r)=>{r.r(j),r.d(j,{IncidentDetailsPageModule:()=>J});var s=r(177),m=r(4341),c=r(7863),v=r(7650),_=r(467),e=r(4438),g=r(2107),C=r(4624),l=r(7473),d=r(8453),a=r(3241);function u(n,p){if(1&n&&(e.j41(0,"ion-card-content")(1,"ion-label",26),e.EFF(2),e.k0s()()),2&n){const o=e.XpG();e.R7$(2),e.JRh(o.incident.state.toUpperCase())}}function f(n,p){if(1&n&&(e.j41(0,"ion-card-content")(1,"ion-label",27),e.EFF(2),e.k0s()()),2&n){const o=e.XpG();e.R7$(2),e.JRh(o.incident.state.toLocaleUpperCase())}}function h(n,p){if(1&n&&(e.j41(0,"ion-card-content")(1,"ion-label",27),e.EFF(2),e.k0s()()),2&n){const o=e.XpG();e.R7$(2),e.JRh(o.incident.urgency.toUpperCase())}}function R(n,p){if(1&n&&(e.j41(0,"ion-card-content")(1,"ion-label",28),e.EFF(2),e.k0s()()),2&n){const o=e.XpG();e.R7$(2),e.JRh(o.incident.urgency.toUpperCase())}}function D(n,p){if(1&n&&(e.j41(0,"ion-card-content")(1,"ion-label",29),e.EFF(2),e.k0s()()),2&n){const o=e.XpG();e.R7$(2),e.JRh(o.incident.urgency.toUpperCase())}}function b(n,p){if(1&n&&(e.j41(0,"ion-card-content")(1,"ion-label",26),e.EFF(2),e.k0s()()),2&n){const o=e.XpG();e.R7$(2),e.JRh(o.incident.urgency.toUpperCase())}}function y(n,p){if(1&n&&(e.j41(0,"ion-card-content")(1,"ion-label",27),e.EFF(2),e.k0s()()),2&n){const o=e.XpG();e.R7$(2),e.JRh(o.incident.org_impact.toUpperCase())}}function F(n,p){if(1&n&&(e.j41(0,"ion-card-content")(1,"ion-label",28),e.EFF(2),e.k0s()()),2&n){const o=e.XpG();e.R7$(2),e.JRh(o.incident.org_impact.toUpperCase())}}function M(n,p){if(1&n&&(e.j41(0,"ion-card-content")(1,"ion-label",29),e.EFF(2),e.k0s()()),2&n){const o=e.XpG();e.R7$(2),e.JRh(o.incident.org_impact.toUpperCase())}}function T(n,p){if(1&n&&(e.j41(0,"ion-card-content")(1,"ion-label",26),e.EFF(2),e.k0s()()),2&n){const o=e.XpG();e.R7$(2),e.JRh(o.incident.org_impact.toUpperCase())}}function k(n,p){if(1&n&&(e.j41(0,"div",12),e.nrm(1,"ion-icon",13),e.j41(2,"ion-label",8),e.EFF(3),e.k0s()()),2&n){const o=p.$implicit;e.R7$(3),e.JRh(o)}}function N(n,p){if(1&n&&(e.j41(0,"div",31)(1,"a",34),e.nrm(2,"img",35),e.k0s()()),2&n){const o=e.XpG().$implicit;e.R7$(),e.FS9("href",o.comment,e.B4B),e.R7$(),e.FS9("src",o.comment,e.B4B)}}function $(n,p){if(1&n&&(e.j41(0,"a",36)(1,"ion-chip"),e.nrm(2,"ion-icon",37),e.j41(3,"ion-label"),e.EFF(4),e.k0s()()()),2&n){const o=e.XpG().$implicit,t=e.XpG();e.FS9("href",o.comment,e.B4B),e.R7$(4),e.JRh(t.fileName(o.comment))}}function B(n,p){if(1&n&&(e.j41(0,"a",36)(1,"ion-chip",38),e.nrm(2,"ion-icon",37),e.j41(3,"ion-label"),e.EFF(4),e.k0s()()(),e.j41(5,"p"),e.EFF(6," This is an unknown file type. "),e.k0s()),2&n){const o=e.XpG().$implicit,t=e.XpG();e.FS9("href",o.comment,e.B4B),e.R7$(4),e.JRh(t.fileName(o.comment))}}function L(n,p){if(1&n&&e.nrm(0,"p",39),2&n){const o=e.XpG().$implicit;e.Y8G("innerHTML",o.comment,e.npT)}}function w(n,p){if(1&n&&(e.qex(0),e.j41(1,"ion-card",30)(2,"ion-card-content"),e.DNE(3,N,3,2,"div",31)(4,$,5,2)(5,B,7,2)(6,L,1,1),e.k0s(),e.j41(7,"ion-card-content",32)(8,"div",33),e.nrm(9,"ion-icon",13),e.j41(10,"ion-label",8),e.EFF(11),e.k0s()()()(),e.bVm()),2&n){const o=p.$implicit,t=e.XpG();e.R7$(),e.AVh("self-end",o.from===t.currentUser)("bg-gray-600",o.from===t.currentUser)("self-start",o.from!==t.currentUser)("bg-gray-800",o.from!==t.currentUser),e.R7$(2),e.vxM(3,t.isImage(o.comment)?3:t.isFile(o.comment)?4:"https:"===o.comment.split("/")[0]||"http:"===o.comment.split("/")[0]?5:6),e.R7$(8),e.JRh(o.from)}}function S(n,p){if(1&n){const o=e.RV6();e.j41(0,"ion-icon",40),e.bIt("click",function(){e.eBV(o);const i=e.XpG(),I=e.sdS(83);return e.Njj(i.uploadFile(I))}),e.k0s()}}function A(n,p){if(1&n){const o=e.RV6();e.j41(0,"ion-icon",41),e.bIt("click",function(){e.eBV(o);const i=e.XpG(),I=e.sdS(83);return e.Njj(i.deleteUploadfile(I))}),e.k0s()}}function G(n,p){if(1&n){const o=e.RV6();e.j41(0,"ion-button",42),e.bIt("click",function(){e.eBV(o);const i=e.XpG();return e.Njj(i.closeIncident())}),e.EFF(1,"Close Incident"),e.k0s()}}function X(n,p){if(1&n){const o=e.RV6();e.j41(0,"ion-button",43),e.bIt("click",function(){e.eBV(o);const i=e.XpG();return e.Njj(i.closeIncident())}),e.EFF(1,"Close Incident"),e.k0s()}2&n&&e.Y8G("disabled",!0)}function z(n,p){if(1&n){const o=e.RV6();e.j41(0,"ion-col",5)(1,"ion-card",6)(2,"ion-card-title",7),e.EFF(3,"Go to Incident Postmortem"),e.k0s(),e.j41(4,"ion-card-content")(5,"p"),e.EFF(6,"Postmortem Culture: Learning from Failure. The postmortem is a retrospective of the incident, focusing on what went wrong, what can be learned, and how to prevent similar incidents in the future."),e.k0s()(),e.j41(7,"ion-card-content",16)(8,"ion-button",44),e.bIt("click",function(){e.eBV(o);const i=e.XpG();return e.Njj(i.postmortemIncident())}),e.EFF(9,"Incident Postmortem"),e.k0s()()()()}}const K=[{path:"",component:(()=>{var n;class p{constructor(t,i,I,E,P){this.router=t,this.activatedRoute=i,this.loadingCtrl=I,this.incidentService=E,this.notificationService=P,this.productStep="",this.productObjective="",this.orgName="",this.currentUser="",this.incident={},this.newComment="",this.storage=(0,e.WQX)(g.wc),this.isImageLoaded=!1,this.decodeURIComponent=decodeURIComponent}ngOnInit(){}ionViewWillEnter(){var t=this;return(0,_.A)(function*(){t.getParams(),yield t.getIncident()})()}getParams(){this.activatedRoute.params.subscribe(i=>{this.productObjective=i.productObjective,this.productStep=i.step,this.incident.title=i.incidentTitle});const t=JSON.parse(localStorage.getItem("user"));this.orgName=t.orgName,this.currentUser=t.name,console.log(this.orgName),console.log(this.productObjective),console.log(this.productStep),console.log(this.incident.title)}getIncident(){var t=this;return(0,_.A)(function*(){yield t.showLoading(),t.incident=yield t.incidentService.getIncident(t.orgName,t.productObjective,t.productStep,t.incident.title),yield t.hideLoading()})()}addComment(){var t=this;return(0,_.A)(function*(){if(yield t.showLoading(),console.log("add comment"),console.log(t.currentUser),console.log(t.newComment),""===t.newComment)return void(yield t.hideLoading());t.incident.report?t.incident.report.push({comment:t.newComment.replace(/\n/g,"<br>"),from:t.currentUser}):t.incident.report=[{comment:t.newComment.replace(/\n/g,"<br>"),from:t.currentUser}],yield t.incidentService.updateIncident(t.orgName,t.productObjective,t.productStep,t.incident);let i=[];i.push({role:"Incident Commander",member:t.incident.incidentCommander}),i.push({role:"Communications Lead",member:t.incident.communications_lead}),i.push({role:"Operations Lead",member:t.incident.operations_lead});for(let E=0;E<t.incident.operation_team.length;E++)i.push({role:"Operations Team Member",member:t.incident.operation_team[E]});console.log(i);const I=window.location.href;yield t.notificationService.notifyIncidentUpdateToTeam(i,t.orgName,I),t.newComment="",t.hideLoading()})()}onImageLoad(){this.isImageLoaded=!0}uploadFile(t){var i=this;return(0,_.A)(function*(){if(yield i.showLoading(),!t.files)return;const I=t.files;for(let E=0;E<I.length;E++){const P=I.item(E);if(P){const Y=(0,g.KR)(i.storage,`incident/${i.orgName}/${i.productObjective}/${i.productStep}/\xb0/${P.name}`);yield(0,g.bp)(Y,P).then(U=>{console.log("Uploaded a blob or file!",U.ref.fullPath),i.downloadFile(U.ref.fullPath).then(function(){var Z=(0,_.A)(function*(x){i.newComment=x,yield i.hideLoading(),yield i.addComment(),i.isImageLoaded=!1});return function(x){return Z.apply(this,arguments)}}())})}}})()}downloadFile(t){var i=this;return(0,_.A)(function*(){let I="";return yield(0,g.qk)((0,g.KR)(i.storage,t)).then(E=>{console.log("File available at",E),I=E}),I})()}isImage(t){return/(\.jpg|\.jpeg|\.png|\.gif|\.bmp|\.webp)(\?|$)/i.test(t)}isFile(t){return/(\.csv|\.pdf|\.doc|\.docx|\.ppt|\.pptx|\.xls|\.xlsx|\.txt|\.mp3|\.wav|\.ogg|\.mp4|\.avi|\.mkv|\.mov|\.zip|\.rar|\.7z|\.tar|\.gz)(\?|$)/i.test(t)}fileName(t){var i;return null===(i=decodeURIComponent(t.split("/").pop().split("?")[0]).split("\xb0").pop())||void 0===i?void 0:i.substring(1)}closeIncident(){var t=this;this.incidentService.closeIncident(this.orgName,this.productObjective,this.productStep,this.incident).then(function(){var i=(0,_.A)(function*(I){I&&(yield t.router.navigate(["/incident-manager",{productObjective:t.productObjective,step:t.productStep}]))});return function(I){return i.apply(this,arguments)}}())}postmortemIncident(){var t=this;return(0,_.A)(function*(){yield t.router.navigate(["/incident-postmortem",{orgName:t.orgName,productObjective:t.productObjective,step:t.productStep,currentUser:t.currentUser,incidentTitle:t.incident.title}])})()}showLoading(){var t=this;return(0,_.A)(function*(){yield(yield t.loadingCtrl.create({})).present()})()}hideLoading(){var t=this;return(0,_.A)(function*(){yield t.loadingCtrl.dismiss()})()}deleteUploadfile(t){t.value="",this.isImageLoaded=!1}}return(n=p).\u0275fac=function(t){return new(t||n)(e.rXU(v.Ix),e.rXU(v.nX),e.rXU(c.Xi),e.rXU(C.I),e.rXU(l.J))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-incident-details"]],decls:100,vars:30,consts:[["upload",""],["title","Incident Details"],[3,"fullscreen"],[3,"title"],[1,"lg:m-10","md:m-10"],["size","12","size-md","12","size-lg","12",1,""],[1,"p-5","flex","flex-col","justify-center","items-center"],[1,"text-2xl"],[1,""],["size","6","size-md","4","size-lg","4",1,""],["size","12","size-md","4","size-lg","4",1,""],["size","6","size-md","6","size-lg","6",1,""],[1,"flex","flex-row","justify-center","items-center"],["name","person-circle",1,"text-2xl"],[1,"p-5","flex","flex-col","justify-center","items-start"],[4,"ngFor","ngForOf"],[1,"flex","flex-row","justify-center","items-center","w-full"],["placeholder","Add a comment","type","text",1,"w-2/3",3,"ngModelChange","hidden","autoGrow","ngModel"],[1,"pl-1","pr-1"],["size","large","name","cloud-upload",3,"click","hidden"],["type","file",2,"display","none",3,"change"],["size","large","class","ion-margin","expand","block","name","save",3,"click",4,"ngIf"],["size","large","class","ion-margin","expand","block","name","trash",3,"click",4,"ngIf"],[1,"w-1/3","m-5",3,"click","hidden"],["color","danger",1,"w-full"],["color","danger",1,"w-full",3,"disabled"],[1,"text-green-800"],[1,"text-red-800"],[1,"text-yellow-800"],[1,"text-yellow-600"],[1,"text-white"],[1,"flex","flex-row","w-full","items-end"],[1,"text-right"],[1,"flex","flex-row","justify-end","items-center"],["target","_blank",1,"",3,"href"],["alt","image",1,"w-1/2",3,"src"],["target","_blank",3,"href"],["name","document"],["color","warning"],[3,"innerHTML"],["size","large","expand","block","name","save",1,"ion-margin",3,"click"],["size","large","expand","block","name","trash",1,"ion-margin",3,"click"],["color","danger",1,"w-full",3,"click"],["color","danger",1,"w-full",3,"click","disabled"],["color","primary",1,"w-full",3,"click"]],template:function(t,i){if(1&t){const I=e.RV6();e.nrm(0,"app-header-return",1),e.j41(1,"ion-content",2)(2,"ion-grid"),e.nrm(3,"app-title",3),e.j41(4,"ion-row",4)(5,"ion-col",5)(6,"ion-card",6)(7,"ion-card-title",7),e.EFF(8),e.k0s(),e.j41(9,"ion-card-content")(10,"p",8),e.EFF(11),e.k0s()()()()(),e.j41(12,"ion-row",4)(13,"ion-col",9)(14,"ion-card",6)(15,"ion-card-title",7),e.EFF(16,"Current Status"),e.k0s(),e.DNE(17,u,3,1,"ion-card-content")(18,f,3,1,"ion-card-content"),e.k0s()(),e.j41(19,"ion-col",9)(20,"ion-card",6)(21,"ion-card-title",7),e.EFF(22,"Urgency"),e.k0s(),e.DNE(23,h,3,1,"ion-card-content")(24,R,3,1,"ion-card-content")(25,D,3,1,"ion-card-content")(26,b,3,1,"ion-card-content"),e.k0s()(),e.j41(27,"ion-col",10)(28,"ion-card",6)(29,"ion-card-title",7),e.EFF(30," Organization Impact"),e.k0s(),e.DNE(31,y,3,1,"ion-card-content")(32,F,3,1,"ion-card-content")(33,M,3,1,"ion-card-content")(34,T,3,1,"ion-card-content"),e.k0s()()(),e.nrm(35,"app-title",3),e.j41(36,"ion-row",4)(37,"ion-col",11)(38,"ion-card",6)(39,"ion-card-title",7),e.EFF(40,"Incident Commander"),e.k0s(),e.j41(41,"ion-card-content")(42,"div",12),e.nrm(43,"ion-icon",13),e.j41(44,"ion-label",8),e.EFF(45),e.k0s()()()()(),e.j41(46,"ion-col",11)(47,"ion-card",6)(48,"ion-card-title",7),e.EFF(49,"Communications Leader"),e.k0s(),e.j41(50,"ion-card-content")(51,"div",12),e.nrm(52,"ion-icon",13),e.j41(53,"ion-label",8),e.EFF(54),e.k0s()()()()(),e.j41(55,"ion-col",5)(56,"ion-card",6)(57,"ion-card-title",7),e.EFF(58,"Operations Lead"),e.k0s(),e.j41(59,"ion-card-content")(60,"div",12),e.nrm(61,"ion-icon",13),e.j41(62,"ion-label",8),e.EFF(63),e.k0s()()(),e.nrm(64,"br"),e.j41(65,"ion-card-title",7),e.EFF(66,"Operations Team"),e.k0s(),e.j41(67,"ion-card-content"),e.Z7z(68,k,4,1,"div",12,e.fX1),e.k0s()()()(),e.nrm(70,"app-title",3),e.j41(71,"ion-row",4)(72,"ion-col",5)(73,"ion-card",14),e.DNE(74,w,12,10,"ng-container",15),e.k0s()(),e.j41(75,"ion-col",5)(76,"ion-card",6)(77,"div",16)(78,"ion-textarea",17),e.mxI("ngModelChange",function(P){return e.eBV(I),e.DH7(i.newComment,P)||(i.newComment=P),e.Njj(P)}),e.k0s(),e.j41(79,"div",18)(80,"ion-icon",19),e.bIt("click",function(){e.eBV(I);const P=e.sdS(83);return e.Njj(P.click())}),e.EFF(81," Add Data "),e.j41(82,"input",20,0),e.bIt("change",function(){return e.eBV(I),e.Njj(i.onImageLoad())}),e.k0s()(),e.DNE(84,S,1,0,"ion-icon",21)(85,A,1,0,"ion-icon",22),e.k0s(),e.j41(86,"ion-button",23),e.bIt("click",function(){return e.eBV(I),e.Njj(i.addComment())}),e.EFF(87,"Add Comment"),e.k0s()()()()(),e.j41(88,"ion-row",4)(89,"ion-col",5)(90,"ion-card",6)(91,"ion-card-title",7),e.EFF(92,"Change Incident State"),e.k0s(),e.j41(93,"ion-card-content")(94,"p"),e.EFF(95,"Change the state of the incident to closed or open.Only the incident commander can change the state of the incident."),e.k0s()(),e.j41(96,"ion-card-content",16),e.DNE(97,G,2,0,"ion-button",24)(98,X,2,1,"ion-button",25),e.k0s()()(),e.DNE(99,z,10,0,"ion-col",5),e.k0s()()()}2&t&&(e.R7$(),e.Y8G("fullscreen",!0),e.R7$(2),e.Y8G("title","Incident Details"),e.R7$(5),e.JRh(i.incident.title),e.R7$(3),e.JRh(i.incident.description),e.R7$(6),e.vxM(17,"open"===i.incident.state?17:-1),e.R7$(),e.vxM(18,"closed"===i.incident.state?18:-1),e.R7$(5),e.vxM(23,"Critical"===i.incident.urgency?23:-1),e.R7$(),e.vxM(24,"High"===i.incident.urgency?24:-1),e.R7$(),e.vxM(25,"Medium"===i.incident.urgency?25:-1),e.R7$(),e.vxM(26,"Low"===i.incident.urgency?26:-1),e.R7$(5),e.vxM(31,"Extensive/Widespread"===i.incident.org_impact?31:-1),e.R7$(),e.vxM(32,"Significant/Large"===i.incident.org_impact?32:-1),e.R7$(),e.vxM(33,"Moderate/Limited"===i.incident.org_impact?33:-1),e.R7$(),e.vxM(34,"Minor/Localized"===i.incident.org_impact?34:-1),e.R7$(),e.Y8G("title","Incident Team"),e.R7$(10),e.JRh(i.incident.incidentCommander),e.R7$(9),e.JRh(i.incident.communications_lead),e.R7$(9),e.JRh(i.incident.operations_lead),e.R7$(5),e.Dyx(i.incident.operation_team),e.R7$(2),e.Y8G("title","Incident Progress"),e.R7$(4),e.Y8G("ngForOf",i.incident.report),e.R7$(4),e.Y8G("hidden",i.isImageLoaded)("autoGrow",!0),e.R50("ngModel",i.newComment),e.R7$(2),e.Y8G("hidden",i.isImageLoaded),e.R7$(4),e.Y8G("ngIf",i.isImageLoaded),e.R7$(),e.Y8G("ngIf",i.isImageLoaded),e.R7$(),e.Y8G("hidden",i.isImageLoaded),e.R7$(11),e.vxM(97,i.currentUser===i.incident.incidentCommander&&"open"===i.incident.state?97:-1),e.R7$(),e.vxM(98,i.currentUser!==i.incident.incidentCommander||"closed"===i.incident.state?98:-1),e.R7$(),e.vxM(99,"closed"===i.incident.state||"postmortem"===i.incident.state?99:-1))},dependencies:[s.Sq,s.bT,m.BC,m.vS,c.Jm,c.b_,c.I9,c.tN,c.ZB,c.hU,c.W9,c.lO,c.iq,c.he,c.ln,c.nc,c.Gw,d.W,a.p]}),p})()}];let W=(()=>{var n;class p{}return(n=p).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[v.iI.forChild(K),v.iI]}),p})();var H=r(5553);let J=(()=>{var n;class p{}return(n=p).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[s.MD,m.YN,c.bv,W,H.h]}),p})()},4796:(O,j,r)=>{r.d(j,{u:()=>_});var s=r(467),m=r(8737),c=r(4262),v=r(4438);let _=(()=>{var e;class g{constructor(l,d){this.auth=l,this.firestore=d}registerUser(l){var d=this;return(0,s.A)(function*(){try{const a=yield(0,m.eJ)(d.auth,l.email,l.password);return a.user?(yield(0,c.BN)((0,c.H9)(d.firestore,"users",a.user.uid),{email:l.email,name:l.name,orgName:l.orgName,uid:a.user.uid}),yield(0,c.BN)((0,c.H9)(d.firestore,"teams",`${l.orgName}`),{name:l.orgName,members:[a.user.uid]}),a):null}catch{return null}})()}loginUser(l){var d=this;return(0,s.A)(function*(){try{var a;const u=yield(0,m.x9)(d.auth,l.email,l.password);if(null!==(a=u.user)&&void 0!==a&&a.uid){const f=yield(0,c.x7)((0,c.H9)(d.firestore,"users",u.user.uid));if(f.exists())return localStorage.setItem("user",JSON.stringify(f.data())),u}}catch(u){console.error(u)}return null})()}logoutUser(){var l=this;return(0,s.A)(function*(){yield l.auth.signOut()})()}addMember(l){var d=this;return(0,s.A)(function*(){try{const a=yield(0,m.eJ)(d.auth,l.email,l.password);if(!a.user)return!1;const u={email:l.email,name:l.name,orgName:l.orgName,uid:a.user.uid};return yield(0,c.BN)((0,c.H9)(d.firestore,"users",a.user.uid),u),u}catch{return!1}})()}}return(e=g).\u0275fac=function(l){return new(l||e)(v.KVO(m.Nj),v.KVO(c._7))},e.\u0275prov=v.jDH({token:e,factory:e.\u0275fac,providedIn:"root"}),g})()},7473:(O,j,r)=>{r.d(j,{J:()=>e});var s=r(467),m=r(4262),c=r(4438),v=r(1626),_=r(5092);let e=(()=>{var g;class C{constructor(d,a,u){this.firestore=d,this.http=a,this.teamService=u}saveNotificationID(d,a){var u=this;return(0,s.A)(function*(){const f=(0,m.H9)(u.firestore,"users",d.uid),h=yield(0,m.x7)(f);if(h.exists()){const R=h.data();return R.notificationID=a,yield(0,m.BN)(f,R),!0}return console.log("No such document!"),!1})()}getNotificationUser(d){var a=this;return(0,s.A)(function*(){const u=(0,m.H9)(a.firestore,"users",d.uid),f=yield(0,m.x7)(u);if(f.exists()){const h=f.data();return h.notificationID?h.notificationID:""}return console.log("No such document!"),null})()}notifyIncidentToUser(d,a){var u=this;return(0,s.A)(function*(){try{const f=yield u.teamService.getTeamByOrganization(a),h=d.map(b=>b.member),R=f.filter(b=>h.includes(b.name));console.log("team",R);const D="https://devprobeapi.onrender.com/sendNotification";for(let b of R){let y=yield u.getNotificationUser(b);if(console.log("sid",y),""!==y){const M={sid:y,title:"New Incident",type:"new_incident",message:`Hey ${b.name}, you have been assigned a new incident your incident role is ${d.find(T=>T.member===b.name).role}`,target:"https://devprobe-89481.web.app/incident-manager-chooser"};yield u.http.post(D,M).toPromise(),console.log("Notification sent successfully")}else console.log("no sid")}}catch(f){console.log(f)}})()}notifyIncidentUpdateToTeam(d,a,u){var f=this;return(0,s.A)(function*(){try{const h=yield f.teamService.getTeamByOrganization(a),R=d.map(y=>y.member),D=h.filter(y=>R.includes(y.name));console.log("team",D);const b="https://devprobeapi.onrender.com/sendNotification";for(let y of D){let F=yield f.getNotificationUser(y);if(console.log("sid",F),""!==F){const T={sid:F,title:"Incident Update",type:"update_incident",message:`Hey ${y.name}, there are updates to your incident`,target:u};yield f.http.post(b,T).toPromise(),console.log("Notification sent successfully")}else console.log("no sid")}}catch(h){console.log(h)}})()}notifyTestToUser(d,a,u){var f=this;return(0,s.A)(function*(){try{console.log("Notify test to user");const h=yield f.teamService.getTeamByOrganization(a),R=d.member,D=h.filter(y=>y.name===R);console.log("team",D);const b="https://devprobeapi.onrender.com/sendNotification";for(let y of D){let F=yield f.getNotificationUser(y);if(console.log("sid",F),""!==F){const T={sid:F,title:"New Unit Test",type:"test",message:`Hey ${y.name}, you have been assigned a new test`,target:u};yield f.http.post(b,T).toPromise(),console.log("Notification sent successfully")}else console.log("no sid")}}catch(h){console.log(h)}})()}}return(g=C).\u0275fac=function(d){return new(d||g)(c.KVO(m._7),c.KVO(v.Qq),c.KVO(_.O))},g.\u0275prov=c.jDH({token:g,factory:g.\u0275fac,providedIn:"root"}),C})()},5092:(O,j,r)=>{r.d(j,{O:()=>_});var s=r(467),m=r(4262),c=r(4438),v=r(4796);let _=(()=>{var e;class g{constructor(l,d){this.firestore=l,this.authService=d}getTeamByOrganization(l){var d=this;return(0,s.A)(function*(){let a=(0,m.H9)(d.firestore,"teams",l);const h=(yield(0,m.x7)(a)).data();let R=[];for(let D=0;D<h.members.length;D++){a=(0,m.H9)(d.firestore,"users",h.members[D]);const y=(yield(0,m.x7)(a)).data();R.push(y)}return R})()}removeMember(l,d){var a=this;return(0,s.A)(function*(){try{let u=(0,m.H9)(a.firestore,"teams",l);const R=(yield(0,m.x7)(u)).data();let D=R.members.filter(y=>y!==d);return yield(0,m.BN)(u,{name:R.name,members:D}),u=(0,m.H9)(a.firestore,"users",d),yield(0,m.BN)(u,{}),yield a.authService,!0}catch{return!1}})()}addMember(l){var d=this;return(0,s.A)(function*(){try{const a=yield d.authService.addMember(l);if(!a)return!1;const u=(0,m.H9)(d.firestore,"teams",l.orgName),h=(yield(0,m.x7)(u)).data();console.log(h);const R=h;let D=R.members;return D.push(a.uid),console.log(D),yield(0,m.mZ)(u,{name:R.name,members:D}),a.uid}catch{return!1}})()}}return(e=g).\u0275fac=function(l){return new(l||e)(c.KVO(m._7),c.KVO(v.u))},e.\u0275prov=c.jDH({token:e,factory:e.\u0275fac,providedIn:"root"}),g})()}}]);